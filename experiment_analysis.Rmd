---
title: "Sceloporus Climate Water Loss Experiment - Data Analysis"
author: "Savannah Weaver"
date: "August 2021"
output: 
  pdf_document:
    toc: TRUE
---

# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
if (!require("lme4")) install.packages("lme4")
library("lme4") # for LMMs
if (!require("lmerTest")) install.packages("lmerTest")
library("lmerTest") # for p-values
if (!require("broom")) install.packages("broom")
library("broom") # lmer model export
if (!require("broom.mixed")) install.packages("broom.mixed")
library("broom.mixed") # lmer model export
```


# Background and Goals

This data was collected June - August by Master's student Savannah Weaver, advisor Dr. Emily Taylor, and research assistants Robin Bedard, Tess McIntyre, and Taylor Van Rossum. Adult male *Sceloporus occidentalis* were caught across the Cal Poly campus and and in Poly Canyon. This R file analyzes the effect of experimental climate treatments on their hydrophysiology. Please refer to **doi:** for the published scientific journal article and full details.


# Data

Read-in data compiled, formatted, and checked for completeness in 'capture_analysis'. See that file for information related to the variables. Some variables still need to be formatted because they lose their data class in export/import. Attach treatment assignments and format that data. Also compute scaled mass index using the equation derived in 'capture_analysis'.

```{r}
dat <- read.csv("./data/full_exp_data.csv", # filename
                             na.strings=c("","NA") # fix empty cells
                             ) %>%
  mutate(individual_ID = as.character(individual_ID)
         ) %>%
  left_join(read.csv("./data/tmt_assignments.csv"),
            by = c("individual_ID")
            ) %>%
  dplyr::select(-X, -capture_date, - notes) %>%
  mutate(measurement_date = as.Date(measurement_date, 
                                          format = "%Y-%m-%d"),
                type = as.factor(type),
                day = as.factor(day),
                individual_ID = as.factor(individual_ID), ###
                blood_sample_eye = as.factor(blood_sample_eye),
                hemolyzed = as.factor(hemolyzed),
                trial_number = as.factor(trial_number),
                tmt = as.factor(paste(temp_tmt, humidity_tmt)),
                conclusion = as.factor(conclusion),
                SVL_mm = as.factor(SVL_mm)
                ) %>%
  dplyr::filter(conclusion == "complete") %>%
  dplyr::filter(complete.cases(individual_ID, mass_g))
# add scaled mass index

summary(dat)
```





## Check Starting Mass by Tmt & Trial


```{r}
mass_check_dat <- exp_dat %>%
  group_by(individual_ID) %>%
  summarise(cap_date = min(cap_date)) %>%
  dplyr::filter(individual_ID < 294) %>%
  left_join(exp_dat, by = c('individual_ID', 'cap_date')) %>%
  left_join(tmts, by = 'individual_ID') %>%
  mutate(temp_tmt = as.factor(temp_tmt),
         humidity_tmt = as.factor(humidity_tmt),
         mass_g = as.numeric(mass_g))
summary(mass_check_dat)

mass_check_dat %>%
  group_by(temp_tmt, humidity_tmt) %>%
  summarise(avg_mass = mean(mass_g),
            n = n())
```














re-order some factors:

```{r reorder all_dat humidity factor}
all_dat$humidity_tmt_percent <- factor(all_dat$humidity_tmt_percent,
                                       levels = c("humid", "dry"),
                                       labels = c("Humid", "Dry"))
```


make a sub-dataframe without rehab data to prevent any mix-ups:

```{r extra df}
dat_no_rehab <- dat %>%
  dplyr::filter(type != "rehab")
```


### Checks

  dplyr::filter(mass_g<18) %>% # wtf...fix later


Dates:

```{r check dates}
# check that capture dates are valid
unique(all_dat$capture_date)
```

Check that each lizard only has an accurate number of measurements.

```{r check n measures per lizard}
all_dat %>%
  group_by(individual_ID, type) %>%
  summarise(n = n()) %>%
  arrange(type)
```


That all looks good, experimental measurements are either 4 (first trial) or 2 (other trials). I am excluding lizards that died in treatment from the analysis.



# Experiment Effects

## SMI ~ Time

plot over course of experiment:

```{r SMI fig}
dat_no_rehab %>% 
  dplyr::filter(mass_g<18) %>% # wtf...fix later
  ggplot(data = .) + 
  geom_point(aes(x = day_n,
                 y = SMI, 
                 color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) +
  stat_smooth(aes(x = day_n, 
                  y = SMI, 
                  color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  geom_line(aes(x = day_n,
                y = SMI,
                group = individual_ID,
                color = tmt),
            alpha = 0.2) +
  theme_classic() + 
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2",
                     name = "") +
  xlab("Day") + 
  ylab("Body Condition (g)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "right"
) -> tmt_effects_SMI
tmt_effects_SMI

# export figure
ggsave(filename = "tmt_effects_SMI.jpeg",
       plot = tmt_effects_SMI,
       path = "./results_figures",
       device = "jpeg",
       dpi = 1200,
       width = 8, height = 4) # width 5 without legend
```

Check whether means started out different:

```{r SMI check original difference}
SMI_diff_lm <- all_dat_no_rehab %>%
  dplyr::filter(day == 0) %>%
  lm(data = ., SMI ~ humidity_tmt_percent)
summary(SMI_diff_lm)
```

NOT significantly different, which is good.

Check whether means ended differently:

```{r SMI check original difference}
SMI_diff_lm_end <- all_dat_no_rehab %>%
  dplyr::filter(day %in% c(8, 9)) %>%
  lm(data = ., SMI ~ humidity_tmt_percent)
summary(SMI_diff_lm_end)
```


mixed model:

```{r SMI models}
SMI_mod <- lme4::lmer(data = all_dat_no_rehab,
               SMI ~ day*humidity_tmt_percent +
               (1|trial_number))
summary(SMI_mod)
drop1(SMI_mod) # this was more intuitive using lme4::lmer but I switched to be able to get p-values

# drop interaction term
SMI_mod2 <- lmerTest::lmer(data = all_dat_no_rehab,
               SMI ~ day + humidity_tmt_percent +
               (1|trial_number))
summary(SMI_mod2)
drop1(SMI_mod2)
```

SMI is best predicted by day and treatment, but not including their interaction.

```{r}
write.csv(broom.mixed::tidy(SMI_mod2), 
          "./best models/exp_effects_SMI.csv")
```


## Hct ~ Time

```{r hct fig}
dat_no_rehab %>% 
  dplyr::filter(complete.cases(hematocrit_percent)) %>%
  ggplot(data = .) + 
  geom_point(aes(x = day_n,
                 y = hematocrit_percent, 
                 color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) +
  stat_smooth(aes(x = day_n, 
                  y = hematocrit_percent, 
                  color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  geom_line(aes(x = day_n,
                y = hematocrit_percent,
                group = individual_ID,
                color = tmt),
            alpha = 0.2) +
  theme_classic() + 
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2",
                     name = "") +
  xlab("Day") + 
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        #legend.text = element_text(color = "black", 
         #                        family = "sans", 
          #                       size = 10),
        legend.text.align = 0,
        legend.position = "right"
        ) -> tmt_effects_hct
tmt_effects_hct

# export figure
ggsave(filename = "tmt_effects_hct.jpeg",
       plot = tmt_effects_hct,
       path = "./output_figures",
       device = "jpeg",
       dpi = 1200,
       width = 8, height = 4)
```

this model seemed to work well with indiv as a random factor, but still excluded because it's probably unnecessary

```{r hct models}
hct_mod <- all_dat_no_rehab %>%
  dplyr::filter(complete.cases(hematocrit_percent)) %>%
  lme4::lmer(data = .,
               hematocrit_percent ~ day + humidity_tmt_percent +
               (1|trial_number))
summary(hct_mod)
drop1(hct_mod)

# drop humidity
hct_mod2 <- all_dat_no_rehab %>%
  dplyr::filter(complete.cases(hematocrit_percent)) %>%
  lmerTest::lmer(data = .,
               hematocrit_percent ~ day +
               (1|trial_number))
summary(hct_mod2)
drop1(hct_mod2)
```

The model AIC is slightly better without the interaction effect, so I removed that. The effect of humidity could ALSO be dropped, so humidity treatment was not an important factor affecting hematocrit, but how many days lizards were in treatment was. Both treatment groups lost hematocrit at approximately the same rate. 

```{r}
write.csv(broom::tidy(hct_mod2), 
          "./output_models/exp_effects_hct.csv")
```



## Osml ~ Time

```{r osmolality fig}
dat_no_rehab %>% 
  dplyr::filter(complete.cases(osmolality_mmol_kg)) %>% 
  dplyr::filter(osmolality_mmol_kg<500) %>% # remove once I figure out why weird
  ggplot(data = .) + 
  geom_point(aes(x = day_n,
                 y = osmolality_mmol_kg, 
                 color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) +
  stat_smooth(aes(x = day_n, 
                  y = osmolality_mmol_kg, 
                  color = tmt
                  ), 
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1 ) + 
  geom_line(aes(x = day_n,
                y = osmolality_mmol_kg,
                group = individual_ID,
                color = tmt),
            alpha = 0.2) +
  theme_classic() + 
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2",
                     name = "") +
  xlab("Day") + 
  ylab("Osmolality (mmol / kg)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "right"
        ) -> tmt_effects_osml
tmt_effects_osml

# export figure
ggsave(filename = "tmt_effects_osml.jpeg",
       plot = tmt_effects_osml,
       path = "./output_figures",
       device = "jpeg",
       dpi = 1200,
       width = 8, height = 4)
```

singular warning - do NOT include individual ID as a random effect

```{r osmolality model}
osml_mod <- all_dat_no_rehab %>%
  dplyr::filter(complete.cases(osmolality_mmol_kg)) %>%
  lmerTest::lmer(data = .,
               osmolality_mmol_kg ~ day * humidity_tmt_percent +
               (1|trial_number))
summary(osml_mod)
drop1(osml_mod)
```

The model seems good as-is. 

```{r}
write.csv(broom::tidy(osml_mod), 
          "./best models/exp_effects_osml.csv")
```



## Change in Osmolality

```{r osmol change data}
osml_d0 <- all_dat_no_rehab %>%
  dplyr::filter(day == 0) %>%
  dplyr::select(individual_ID, osml0 = osmolality_mmol_kg, 
                humidity_tmt_percent)
osml_d8 <- all_dat_no_rehab %>%
  dplyr::filter(day %in% c(8,9)) %>%
  dplyr::select(individual_ID, osml89 = osmolality_mmol_kg, 
                humidity_tmt_percent)

osml_diffs <- osml_d0 %>%
  left_join(osml_d8) %>%
  mutate(osml_change = osml89 - osml0)
```


boxplot:

```{r osmol change fig}
osml_diffs %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = humidity_tmt_percent, 
                   y = osml_change, 
                   group = humidity_tmt_percent,
                   color = humidity_tmt_percent
                   ), 
               size = 1,
               alpha = 1) + 
  theme_classic() + 
  geom_hline(yintercept = 0) +
  xlab("") + 
  ylab("Osmolality Change (mmol / kg)") + 
  scale_color_brewer(palette = "Set2") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14),
        legend.text.align = 0,
        legend.position = "none"
)
```



## CEWL ~ Before/After

try a boxplot:

```{r CEWL fig 1}
CEWL %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = humidity_tmt_percent, 
                   y = TEWL_g_m2h, 
                   color = day
                   ), 
               size = 1,
               alpha = 1) + 
  facet_wrap(~region) +
  theme_classic() + 
  xlab("") + 
  ylab("CEWL (g / m^2h)") + 
  scale_color_brewer(palette = "Set2") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14),
        legend.text.align = 0,
        legend.position = "bottom"
)
```

this is difficult to see changes, I think a line graph would be better...

```{r CEWL fig 2}
dat %>% 
  dplyr::filter(complete.cases(CEWL_g_m2h)) %>%
  ggplot(data = .) + 
  geom_point(aes(x = day_n,
                 y = CEWL_g_m2h, 
                 color = tmt
                 ), 
             size = 1, 
             alpha = 0.6) +
  geom_line(aes(x = day_n,
                y = CEWL_g_m2h,
                group = individual_ID,
                color = tmt),
            alpha = 0.2) +
  stat_smooth(aes(x = day_n, 
                  y = CEWL_g_m2h, 
                  color = tmt
                  ),
              formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1.6, 
              alpha = 1) + 
  theme_classic() + 
  scale_color_brewer(palette = "Set2",
                     name = "") +
  scale_x_continuous(breaks = c(0, 8),
                     labels = c("0" = "before", "8" = "after")
                     ) +
  xlab("") + 
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14,
                                 angle = 90),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "right"
) -> CEWL_tmt_fig
CEWL_tmt_fig

# export figure
ggsave(filename = "tmt_effects_CEWL.jpeg",
       plot = CEWL_tmt_fig,
       path = "./results_figures",
       device = "jpeg",
       dpi = 1200,
       width = 6, height = 4)
```

I saved the legend separately to make the figure layout better.

```{r CEWL model 1}
CEWL_mod <- CEWL %>%
  lme4::lmer(data = .,
               TEWL_g_m2h ~ day * humidity_tmt_percent * region +
               cloacal_temp_C +
               (1|trial_number/individual_ID))
summary(CEWL_mod)
drop1(CEWL_mod)
```

Drop triple interaction. I think the day:region standalone would be weird too.

```{r CEWL model 2}
CEWL_mod2 <- CEWL %>%
  lme4::lmer(data = .,
               TEWL_g_m2h ~ 
               humidity_tmt_percent * (day + region) +
               cloacal_temp_C +
               (1|trial_number/individual_ID))
summary(CEWL_mod2)
drop1(CEWL_mod2)
```

We can drop the humidity:region interaction.

```{r CEWL model 3}
CEWL_mod3 <- CEWL %>%
  dplyr::filter(complete.cases(.)) %>%
  lmerTest::lmer(data = .,
               TEWL_g_m2h ~ 
               day*humidity_tmt_percent + region + cloacal_temp_C +
               (1|trial_number/individual_ID))
summary(CEWL_mod3)
drop1(CEWL_mod3)
```

The model is best with all the parameters currently included in model 3. 

```{r}
write.csv(broom::tidy(CEWL_mod3), 
          "./best models/exp_effects_CEWL.csv")
```


## Change in CEWL

```{r CEWL change data}
CEWL_before <- CEWL %>%
  dplyr::filter(day == "before") %>%
  dplyr::select(CEWL_before = TEWL_g_m2h,
                humidity_tmt_percent, trial_number,
                individual_ID, region)
CEWL_after <- CEWL %>%
  dplyr::filter(day == "after") %>%
  dplyr::select(CEWL_after = TEWL_g_m2h,
                humidity_tmt_percent, trial_number,
                individual_ID, region)

CEWL_diffs <- CEWL_before %>%
  left_join(CEWL_after, by = c('individual_ID', 'region',
                'humidity_tmt_percent', 'trial_number')) %>%
  mutate(CEWL_diff = CEWL_after - CEWL_before)
```


plot:

```{r CEWL change fig}
CEWL_diffs %>% 
  ggplot(data = .) + 
  geom_boxplot(aes(x = humidity_tmt_percent, 
                   y = CEWL_diff, 
                   group = humidity_tmt_percent,
                   color = humidity_tmt_percent
                   ), 
               size = 1,
               alpha = 1) + 
  #facet_wrap(~humidity_tmt_percent) +
  theme_classic() + 
  geom_hline(yintercept = 0, lty = 2) +
  xlab("") + 
  ylab("CEWL Change (g/m2h)") + 
  #annotate("text", x = 1.5, y = 45, 
   #        label = "paste(italic(p), \" = 0.0152\")", 
    #       parse = TRUE,
     #      size = 6) +
  #ylim(10, 50) +
  #scale_x_discrete(labels = c("F" = "Female",
   #                           "M" = "Male")) +
  scale_color_brewer(palette = "Set2") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14),
        legend.text.align = 0,
        legend.position = "none"
)
```



## Multi-Figure

```{r}
ggarrange(tmt_effects_osml, tmt_effects_SMI, tmt_effects_hct,
          ncol = 1, nrow = 3,
          common.legend = TRUE,
          legend = "bottom"
          ) -> tmt_multi_fig
tmt_multi_fig
# export figure
#ggsave(filename = "tmt_multi_fig.jpeg",
 #      plot = tmt_multi_fig,
  #     path = "./final_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 6, height = 12)
```

# Rehydration Effects

## Data

First, get only the data for before experiment, after experiment, and after rehab.

```{r rehydration model}
summary(all_dat)
rehydrat_dat <- all_dat %>%
  dplyr::filter(day %in% c(0, 8, 9, 10, 11))
rehydrat_dat$day <- factor(rehydrat_dat$day,
                           levels = c(0, 8, 9, 10, 11),
                           labels = c("Before Experiment",
                                      "After Experiment",
                                      "After Experiment",
                                      "After Rehydration",
                                      "After Rehydration"))
summary(rehydrat_dat)
```


prepare summary data to overlay on plots:

```{r}
hydrat_means <- rehydrat_dat %>%
  dplyr::filter(complete.cases(osmolality_mmol_kg, SMI, 
                               hematocrit_percent)) %>%
  group_by(humidity_tmt_percent, day) %>%
  summarise(osml_mean = mean(osmolality_mmol_kg),
            SMI_mean = mean(SMI),
            hct_mean = mean(hematocrit_percent))
hydrat_means
```



## SMI


```{r rehydration SMI fig}
ggplot() + 
  geom_point(data = rehydrat_dat,
             aes(x = day,
                 y = SMI, 
                 color = humidity_tmt_percent
                 ), 
             size = 1, 
             alpha = 0.6) + 
  geom_line(data = rehydrat_dat,
            aes(x = day,
                y = SMI,
                group = individual_ID,
                color = humidity_tmt_percent),
            alpha = 0.2) +
  geom_line(data = hydrat_means, # new data
            aes(x = day,
                y = SMI_mean,
                group = humidity_tmt_percent,
                color = humidity_tmt_percent),
            size = 1.6,
            alpha = 1) +
  theme_classic() + 
  scale_color_brewer(palette = "Set2",
                     name = "Humidity Treatment") +
  scale_x_discrete(labels = c("Before\nExperiment",
                              "After\nExperiment",
                              "After\nRehydration")) +
  xlab("") + 
  xlab("") + 
  ylab("Body Condition (g)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14),
        legend.text.align = 0,
        legend.position = "bottom"
        ) -> rehab_SMI_fig
rehab_SMI_fig

# export figure
#ggsave(filename = "rehab_SMI_fig.jpeg",
 #      plot = rehab_SMI_fig,
  #     path = "./final_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 5, height = 4)
```


## Osmolality

first, make a list of all the IDs that have a post-rehab osmolality measurement, since this has a lot of missing data

```{r rehydration osmol data}
rehab_osmols <- rehydrat_dat %>%
  dplyr::filter(day == "After Rehydration") %>%
  dplyr::filter(complete.cases(osmolality_mmol_kg))
```


```{r rehydration osmol fig}
rehydrat_dat %>% 
  dplyr::filter(individual_ID %in% rehab_osmols$individual_ID) %>%
  ggplot(data = .) + 
  geom_point(aes(x = day,
                 y = osmolality_mmol_kg, 
                 color = humidity_tmt_percent
                 ), 
             size = 1, 
             alpha = 0.6) +
  geom_line(aes(x = day,
                y = osmolality_mmol_kg,
                group = individual_ID,
                color = humidity_tmt_percent),
            alpha = 0.2) +
  geom_line(data = hydrat_means, # new data
            aes(x = day,
                y = osml_mean,
                group = humidity_tmt_percent,
                color = humidity_tmt_percent),
            size = 1.6,
            alpha = 1) +
  theme_classic() + 
  scale_color_brewer(palette = "Set2",
                     name = "Humidity Treatment") +
  scale_x_discrete(labels = c("Before\nExperiment",
                              "After\nExperiment",
                              "After\nRehydration")) +
  xlab("") + 
  xlab("") + 
  ylab("Osmolality (mmol/kg)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14),
        legend.text.align = 0,
        legend.position = "bottom"
  ) -> rehab_osml_fig
rehab_osml_fig

# export figure
#ggsave(filename = "rehab_osml_fig.jpeg",
 #      plot = rehab_osml_fig,
  #     path = "./final_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 5, height = 4)
```



## Hematocrit

first, make a list of all the IDs that have all three measurements:

```{r rehydration hct data}
rehab_hct <- rehydrat_dat %>%
  dplyr::filter(day == "After Rehydration") %>%
  dplyr::filter(complete.cases(hematocrit_percent))
```


```{r rehydration hct fig}
rehydrat_dat %>% 
  dplyr::filter(individual_ID %in% rehab_osmols$individual_ID) %>%
  ggplot(data = .) + 
  geom_point(aes(x = day,
                 y = hematocrit_percent, 
                 color = humidity_tmt_percent
                 ), 
             size = 1, 
             alpha = 0.6) +
  geom_line(aes(x = day,
                y = hematocrit_percent,
                group = individual_ID,
                color = humidity_tmt_percent),
            alpha = 0.2) +
  geom_line(data = hydrat_means, # new data
            aes(x = day,
                y = hct_mean,
                group = humidity_tmt_percent,
                color = humidity_tmt_percent),
            size = 1.6,
            alpha = 1) +
  theme_classic() + 
  scale_color_brewer(palette = "Set2",
                     name = "Humidity Treatment") +
  scale_x_discrete(labels = c("Before\nExperiment",
                              "After\nExperiment",
                              "After\nRehydration")) +
  xlab("") + 
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 18),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 14),
        legend.text.align = 0,
        legend.position = "bottom"
  ) -> rehab_hct_fig
rehab_hct_fig

# export figure
#ggsave(filename = "rehab_hct_fig.jpeg",
 #      plot = rehab_hct_fig,
  #     path = "./final_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 5, height = 4)
```


## Multi-Figure

```{r}
ggarrange(rehab_osml_fig, rehab_SMI_fig, rehab_hct_fig,
          ncol = 1, nrow = 3,
          common.legend = TRUE,
          legend = "bottom"
          ) -> rehab_multi_fig
rehab_multi_fig
# export figure
#ggsave(filename = "rehab_multi_fig.jpeg",
 #      plot = rehab_multi_fig,
  #     path = "./final_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 6, height = 12)
```



