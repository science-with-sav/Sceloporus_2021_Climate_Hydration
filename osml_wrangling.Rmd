---
title: "Climate Water Loss Experiment - Plasma Osmolality Data Wrangling"
author: "Savannah Weaver"
date: "August 2021"
output: pdf_document
---


# Packages

```{r setup, include=FALSE}
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse") # workflow and plots
if (!require("UsingR")) install.packages("UsingR")
library("UsingR")
if (!require("lme4")) install.packages("lme4")
library("lme4") # for LMMs
if (!require("lmerTest")) install.packages("lmerTest")
library("lmerTest") # for p-values
```


# Background and Goals

Blood was drawn from the postorbital sinus of adult male *Sceloporus occidentalis* between June - August. After centrifuging and separating, plasma was run on a VAPRO vapor pressure osmometer in 1-4 replicates, when plasma volume collected allowed. In this R script, I check the distribution of replicates, omit outliers, and average remaining replicates. The final values will be more precise and accurate estimates of the true plasma osmolality for each lizard, and those values will be used in the capture_analysis and experiment_analysis R script files. Please refer to **doi:** for the published scientific journal article and full details.


# Load Data

```{r}
osml_reps <- read.csv("./data/osmolality.csv",
                na.strings = c("","NA"),
                header = TRUE
                ) %>%
    dplyr::mutate(date_blood_drawn = as.Date(date_blood_drawn,
                                             format = "%m/%d/%y"),
                  date_osmom_run = as.Date(date_osmom_run,
                                           format = "%m/%d/%y"),
                  time_osmom_run = as.POSIXct(time_osmom_run, 
                                               format = "%H:%M"),
                  individual_ID = as.factor(individual_ID),
                  # add as factor rep no
                  osmolality_mmol_kg = as.numeric(osmolality_mmol_kg)
                  )
summary(osml_reps)
```


# Check Data




# Format Data


# Check Data

## Number of Measurements

Re-check how many measurements each individual has:

```{r}

```


## Measurement Times

Also check that all the measurement times for a given individual on a certain date are within ~10 minutes:

```{r}

```






# Replicates

## Check Distribution

## Remove Outliers

## Re-Check Distribution


## Average Replicates (outliers now removed) & Join Cloacal Temp Data

```{r}
osml_means <- osml_reps %>%
  group_by(date_blood_drawn, individual_ID) %>%
  summarise(osmolality_mmol_kg = mean(osmolality_mmol_kg))
```


# Export

```{r}
write.csv(osml_means, "./data/osml_means_clean.csv")
```



*other stuff*
after finishing CEWL, go straight to avg osml
do very simple invert analysis of just water content over time
















