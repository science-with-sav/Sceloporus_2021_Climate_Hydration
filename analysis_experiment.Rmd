---
title: "Climate Water Loss Experiment - Treatment Hydration Analysis"
author: "Savannah Weaver"
date: "2021"
output: pdf_document
toc: TRUE
---

# Packages


```{r setup, include = TRUE, message = FALSE}
`%nin%` = Negate(`%in%`)
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse") # workflow and plots
if (!require("lme4")) install.packages("lme4")
library("lme4") # for LMMs
if (!require("lmerTest")) install.packages("lmerTest")
library("lmerTest") # for p-values
if (!require("ggpubr")) install.packages("ggpubr")
library("ggpubr") # for multi-ggplot figs
if (!require("UsingR")) install.packages("UsingR")
library("UsingR") # simple.eda model assumption checker
if (!require("broom.mixed")) install.packages("broom.mixed")
library("broom.mixed") # lmer model export
if (!require("car")) install.packages("car")
library("car") # VIFs
if (!require("AICcmodavg")) install.packages("AICcmodavg")
library("AICcmodavg") # model selection
if (!require("RColorBrewer")) install.packages("RColorBrewer")
library("RColorBrewer") # color
```


# Background and Goals

This data was collected June - August by Master's student Savannah Weaver, advisor Dr. Emily Taylor, and research assistants Tess McIntyre and Taylor Van Rossum. Adult male *Sceloporus occidentalis* were caught across the Cal Poly campus then acclimated to 4 different climate treatments. **This R file analyzes the effect of experimental climate treatments on lizard body condition, osmotic balance, and osmoregulation.** Please refer to the published scientific journal article for full details.


# Data

## Load

Read-in data that was compiled, formatted, and checked for completeness in 'wrangling_general'. See that file for information related to the variables.

```{r load data}
dat <- read_rds("./data/analysis_data_experiment.RDS")
summary(dat)
```





## Split

Make sub-dataframes without rehab data / with only rehab-related data:

```{r sub-dfs}
dat_no_rehab <- dat %>%
  dplyr::filter(day_n %in% c(seq(0,8)))
dat_for_rehab <- dat %>%
  dplyr::filter(day_n %in% c(8, 10))
```



## Check

Dates:

```{r check dates}
unique(dat$measurement_date)
```

Number of measurements for each lizard:

```{r check n msmts}
dat_no_rehab %>%
  group_by(individual_ID) %>%
  summarise(n = n()) %>%
  arrange(n)
```


Every lizard has 6 experimental measurements: pre-tmt, mid-tmt, post-tmt, and mass checks on each of the 3 days between mid and post-tmt.


Did any of the treatment groups inherently start out with large differences in response variables?


```{r check starting diffs}
dat %>%
  dplyr::filter(day_n == 0) %>%
  group_by(tmt) %>%
  summarise(mean(mass_g),
            sd(mass_g),
            mean(SMI),
            mean(hematocrit_percent),
            mean(osmolality_mmol_kg_mean),
            mean(CEWL_g_m2h_mean))
```

There are slight differences, but overall the starting values across groups are more or less the same.



# Experiment Models

We predicted that there would be effects of day, humidity, and temperature, but we only expect those **interactions with day** to have an effect because we're observing changes over time.

So, each full model will include the following: day_n, day_n:humidity_tmt, day_n:temp_tmt, and day_n:humidity_tmt:temp_tmt. Then I'll test whether dropping any variables will improve the model.

## SMI

### Building

Models are named based on the number of predictors.

```{r SMI exp model 4}
SMI_mod4 <- lme4::lmer(data = dat_no_rehab,
                       SMI ~ day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number/individual_ID))
car::vif(SMI_mod4) # check collinearity 
summary(SMI_mod4)
drop1(SMI_mod4)
```

This is the best model based on AIC, but we will check dropping the 3-way interaction.

```{r SMI exp model 3a}
SMI_mod3a <- lme4::lmer(data = dat_no_rehab,
                       SMI ~ 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         (1|trial_number/individual_ID))
car::vif(SMI_mod3a) # check collinearity 
```

All the variables in the full models had huge t-values and we lose significant predictive power without the three-way interaction. So, the full model is the best model to predict SMI/ Body Condition.






### Assumptions

Check linear regression assumptions/conditions:

```{r SMI exp model assumptions}
plot(SMI_mod4)
simple.eda(residuals(SMI_mod4))
shapiro.test(residuals(SMI_mod4))
hist(dat_no_rehab$SMI)
```

Normality of the residuals is very violated, but with our large sample size that should not effect results, and the SMI variable is perfectly evenly distributed, so it should be fine. Equal error variance and linearity look fantastic.


### Save

Save best model stats with p-values:

```{r best SMI exp model}
SMI_mod_best1 <- lmerTest::lmer(data = dat_no_rehab, 
                                SMI ~ day_n +
                                 day_n:humidity_tmt + day_n:temp_tmt +
                                  day_n:humidity_tmt:temp_tmt +
                                 (1|trial_number/individual_ID))
summary(SMI_mod_best1)
SMI_stats <- broom.mixed::tidy(SMI_mod_best1) %>%
  mutate(response = "Body Condition (g)")
```



## Hematocrit

### Building


```{r hct exp model 4}
hct_mod4 <- lme4::lmer(data = dat_no_rehab,
                       hematocrit_percent ~ day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number/individual_ID))
car::vif(hct_mod4) # check collinearity 
summary(hct_mod4)
drop1(hct_mod4)
```

It seems like it could be beneficial to drop variables, so test each 1-variable drop:

```{r hct exp model 3a}
hct_mod3a <- lme4::lmer(data = dat_no_rehab,
                       hematocrit_percent ~ 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         (1|trial_number/individual_ID))
car::vif(hct_mod3a) # check collinearity 
anova(hct_mod4, hct_mod3a)
```

We do NOT lose predictive power by dropping the three-way interaction from the hematocrit model, so we should definitely drop it.

Test whether we should drop any of the remaining variables:

Not necessarily different or better.

```{r hct exp model 2b}
hct_mod2b <- lme4::lmer(data = dat_no_rehab,
                       hematocrit_percent ~ 
                         day_n + day_n:temp_tmt +
                         (1|trial_number/individual_ID))
anova(hct_mod3a, hct_mod2b)
```

We do NOT lose predictive power if we drop humidity.

```{r hct exp model 2c}
hct_mod2c <- lme4::lmer(data = dat_no_rehab,
                       hematocrit_percent ~ 
                         day_n + 
                         day_n:humidity_tmt + 
                         (1|trial_number/individual_ID))
anova(hct_mod3a, hct_mod2c)
```

We lose a very significant amount of predictive power if we drop temperature.



### Selection

Compare models that did not lose predictive power when three-way interaction and humidity were dropped.

```{r hct mod compare}
hct_models <- list(hct_mod4, hct_mod3a, hct_mod2b, hct_mod2c)

EXP_mod_names1 <- data.frame(predictors = 
                 c('Day, Day:Humd, Day:Temp, Day:Humd:Temp', #4
                   'Day, Day:Humd, Day:Temp', #3a
                   'Day, Day:Temp', #2b
                   'Day, Day:Humd' #2c
                   ))
rownames(EXP_mod_names1) <- c('4', '3a', '2b', '2c')
#calculate AIC of each model
hct_AICc <- data.frame(aictab(cand.set = hct_models, 
                                 modnames = EXP_mod_names1)) %>%
  mutate(response = "Hematocrit (%)")
hct_AICc
```

Model 2b with only predictors Day and Day*Temp is the best by a good margin.

### Assumptions

Check linear regression assumptions/conditions:

```{r hct exp model assumptions}
plot(hct_mod2b)
simple.eda(residuals(hct_mod2b))
shapiro.test(residuals(hct_mod2b))
```

All assumptions are satisfied (and beautiful). 



### Save

Save full model stats with p-values:

```{r full hct exp model}
hct_mod_full <- lmerTest::lmer(data = dat_no_rehab,
                        hematocrit_percent ~ 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number/individual_ID))
summary(hct_mod_full)
hct_stats_full <- broom.mixed::tidy(hct_mod_full) %>%
  mutate(response = "Hematocrit (%)")
```

Save best model stats (2b) with p-values:

```{r best hct exp model}
hct_mod_best1 <- lmerTest::lmer(data = dat_no_rehab,
                        hematocrit_percent ~ 
                         day_n + day_n:temp_tmt +
                         (1|trial_number/individual_ID))
summary(hct_mod_best1)
hct_stats <- broom.mixed::tidy(hct_mod_best1) %>%
  mutate(response = "Hematocrit (%)")
```







## Osmolality


### Building


```{r osml exp model 4}
osml_mod4 <- lme4::lmer(data = dat_no_rehab,
                       osmolality_mmol_kg_mean ~ 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number/individual_ID))
car::vif(osml_mod4) # check collinearity 
summary(osml_mod4)
drop1(osml_mod4)
```

Dropping the three-way interaction slightly improves AIC, so test that:


```{r osml exp model 3a}
osml_mod3a <- lme4::lmer(data = dat_no_rehab,
                       osmolality_mmol_kg_mean ~ 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         (1|trial_number/individual_ID))
car::vif(osml_mod3a) # check collinearity 
anova(osml_mod4, osml_mod3a)
```

We do NOT lose significant predictive power, so the three-way interaction should be dropped.

Test whether we should drop any remaining variables:

```{r osml exp model 2b}
osml_mod2b <- lme4::lmer(data = dat_no_rehab,
                       osmolality_mmol_kg_mean ~ 
                         day_n + 
                         day_n:temp_tmt +
                         (1|trial_number/individual_ID))
anova(osml_mod3a, osml_mod2b)
```

We do NOT lose significant predictive power if we drop humidity.


```{r osml exp model 2c}
osml_mod2c <- lme4::lmer(data = dat_no_rehab,
                       osmolality_mmol_kg_mean ~ 
                         day_n + 
                         day_n:humidity_tmt +
                         (1|trial_number/individual_ID))
anova(osml_mod3a, osml_mod2c) 
```

We lose significant predictive power if we drop temperature.




### Selection

Compare with/without three-way interaction and humidity:

```{r osml mod compare}
osml_models <- list(osml_mod4, osml_mod3a, osml_mod2b, osml_mod2c)

EXP_mod_names2 <- data.frame(predictors = 
                 c('Day, Day:Humd, Day:Temp, Day:Humd:Temp', #4
                   'Day, Day:Humd, Day:Temp', #3a
                   'Day, Day:Temp', #2b
                   'Day, Day:Humd' #2c
                   ))
rownames(EXP_mod_names2) <- c('4', '3a', '2b', '2c')
#calculate AIC of each model
osml_AICc <- data.frame(aictab(cand.set = osml_models, 
                                 modnames = EXP_mod_names2)) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")
osml_AICc
```


They're all exactly equal, with the full model having SLIGHTLY lower AIC. Since they're all equal, we will use the model with the fewest predictors (2b with day and temp only).


### Assumptions

Check linear regression assumptions/conditions:

```{r osml exp model assumptions}
plot(osml_mod2b)
simple.eda(residuals(osml_mod2b))
shapiro.test(residuals(osml_mod2b))
hist(dat_no_rehab$osmolality_mmol_kg_mean)
```

All assumptions are OKAY. Normality of the residuals is statistically, but not necessarily visually, violated. Osmolality values are slightly skewed to the right, but not enough to transform the variable.



### Save

Save full model stats with p-values:

```{r full osml exp model}
osml_mod_full <- lmerTest::lmer(data = dat_no_rehab,
                        osmolality_mmol_kg_mean ~ 
                          day_n + 
                          day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number/individual_ID))
summary(osml_mod_full)
osml_stats_full <- broom.mixed::tidy(osml_mod_full) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")
```


Save best model stats with p-values:

```{r best osml exp models}
osml_mod_best1 <- lmerTest::lmer(data = dat_no_rehab,
                        osmolality_mmol_kg_mean ~ 
                          day_n + 
                          day_n:temp_tmt +
                         (1|trial_number/individual_ID))
summary(osml_mod_best1)
osml_stats <- broom.mixed::tidy(osml_mod_best1) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")
```






## CEWL


### Building

```{r CEWL exp model 4}
# get df with only CEWL values in it
dat_no_rehab_rm <- dat_no_rehab %>%
  dplyr::filter(complete.cases(CEWL_g_m2h_mean))
CEWL_mod4 <- lme4::lmer(data = dat_no_rehab_rm,
                       CEWL_g_m2h_mean ~ cloacal_temp_C + 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number/individual_ID))
summary(CEWL_mod4)
```


We can and should drop the random effect of individual ID, since it accounts for zero variation.

```{r CEWL exp model 4.2}
CEWL_mod4.2 <- lme4::lmer(data = dat_no_rehab_rm,
                       CEWL_g_m2h_mean ~ cloacal_temp_C + 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number))
summary(CEWL_mod4.2)
drop1(CEWL_mod4.2)
car::vif(CEWL_mod4.2) # check collinearity 
```

All variables have really big t-values and AIC cannot be improved by dropping anything.

But, check 1-variable drop:

```{r CEWL exp model 3a}
CEWL_mod3a <- lme4::lmer(data = dat_no_rehab_rm,
                       CEWL_g_m2h_mean ~ cloacal_temp_C +  
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         (1|trial_number))
anova(CEWL_mod4.2, CEWL_mod3a)
car::vif(CEWL_mod3a) # check collinearity 
```

We lose significant predictive power, so we should NOT drop the three-way interaction.




### Assumptions

Check linear regression assumptions/conditions:

```{r CEWL exp model assumptions}
plot(CEWL_mod4.2)
simple.eda(residuals(CEWL_mod4.2))
shapiro.test(residuals(CEWL_mod4.2))
hist(dat_no_rehab_rm$CEWL_g_m2h_mean)
```

normality is not good, both other assumptions OKAY enough.



### Save

Save best model stats with p-values:

```{r best CEWL exp model}
CEWL_mod_best <- lmerTest::lmer(data = dat_no_rehab,
                       CEWL_g_m2h_mean ~ cloacal_temp_C + 
                         day_n + 
                         day_n:humidity_tmt + day_n:temp_tmt +
                         day_n:humidity_tmt:temp_tmt + 
                         (1|trial_number))
summary(CEWL_mod_best)
CEWL_stats <- broom.mixed::tidy(CEWL_mod_best) %>%
  mutate(response = "CEWL (g/m2h)")
```



## Group Export

Put all the best models and AICc rankings into one csv each

```{r export exp stats}
experiment_stats <- CEWL_stats %>%
  rbind(osml_stats) %>%
  rbind(hct_stats) %>%
  rbind(SMI_stats)
write.csv(experiment_stats, 
          "./results_statistics/exp_models_BEST.csv")

exp_stats_full_secondary <- osml_stats_full %>% rbind(hct_stats_full)
write.csv(exp_stats_full_secondary, 
          "./results_statistics/exp_models_full_additional.csv")

AICc_ranks <- osml_AICc %>%
  rbind(hct_AICc)
write.csv(AICc_ranks, "./results_statistics/exp_model_rankings.csv")
```


**CEWL and body condition were best-predicted by the FULL model. Hematocrit was best-predicted by a reduced model, with delta-AIC of the other models >3.7 (AICc_ranks / exp_model_rankings). Osmolality was predicted equally well by the full and reduced models, so we present the reduced model with the least number of variables (AICc_ranks / exp_model_rankings). The full models for hct and osml are exported in a separate csv.**




# Effect Estimates (from coefficients)

I want to know what the change in the response variables was per day for each treatment group, on average.

So, first make a matrix expressing the 4 treatment groups with 0s (is not) and 1s (it is). For example, if the baseline states (1s) express Cool and Dry, then hot-dry would have a 0 for temperature and 1 for humidity.

```{r}
tmt_matrix <- data.frame(tmt = c("Hot Humid", "Hot Dry", 
                                 "Cool Humid", "Cool Dry"),
                         temp_state = c(0,0,1,1),
                         humid_state = c(0,1,0,1))
tmt_matrix
```


Next, get all the coefficients:

```{r}
# CEWL
CEWL_day_n <- experiment_stats %>% 
  dplyr::filter(response == "CEWL (g/m2h)") %>% 
  dplyr::filter(term == "day_n") %>%
  dplyr::select(estimate)
CEWL_day_n_humidity_tmtDry <- experiment_stats %>% 
  dplyr::filter(response == "CEWL (g/m2h)") %>% 
  dplyr::filter(term == "day_n:humidity_tmtDry") %>%
  dplyr::select(estimate)
CEWL_day_n_temp_tmtCool <- experiment_stats %>% 
  dplyr::filter(response == "CEWL (g/m2h)") %>% 
  dplyr::filter(term == "day_n:temp_tmtCool") %>%
  dplyr::select(estimate)
CEWL_day_n_humidity_tmtDry_temp_tmtCool <- experiment_stats %>% 
  dplyr::filter(response == "CEWL (g/m2h)") %>% 
  dplyr::filter(term == "day_n:humidity_tmtDry:temp_tmtCool") %>%
  dplyr::select(estimate)

# plasma osmolality
osml_day_n <- experiment_stats %>% 
  dplyr::filter(response == "Plasma Osmolality (mmol/kg)") %>% 
  dplyr::filter(term == "day_n") %>%
  dplyr::select(estimate)
osml_day_n_temp_tmtCool <- experiment_stats %>% 
  dplyr::filter(response == "Plasma Osmolality (mmol/kg)") %>% 
  dplyr::filter(term == "day_n:temp_tmtCool") %>%
  dplyr::select(estimate)

# hematocrit
hct_day_n <- experiment_stats %>% 
  dplyr::filter(response == "Hematocrit (%)") %>% 
  dplyr::filter(term == "day_n") %>%
  dplyr::select(estimate)
hct_day_n_temp_tmtCool <- experiment_stats %>% 
  dplyr::filter(response == "Hematocrit (%)") %>% 
  dplyr::filter(term == "day_n:temp_tmtCool") %>%
  dplyr::select(estimate)

# body condition
SMI_day_n <- experiment_stats %>% 
  dplyr::filter(response == "Body Condition (g)") %>% 
  dplyr::filter(term == "day_n") %>%
  dplyr::select(estimate)
SMI_day_n_humidity_tmtDry <- experiment_stats %>% 
  dplyr::filter(response == "Body Condition (g)") %>% 
  dplyr::filter(term == "day_n:humidity_tmtDry") %>%
  dplyr::select(estimate)
SMI_day_n_temp_tmtCool <- experiment_stats %>% 
  dplyr::filter(response == "Body Condition (g)") %>% 
  dplyr::filter(term == "day_n:temp_tmtCool") %>%
  dplyr::select(estimate)
SMI_day_n_humidity_tmtDry_temp_tmtCool <- experiment_stats %>% 
  dplyr::filter(response == "Body Condition (g)") %>% 
  dplyr::filter(term == "day_n:humidity_tmtDry:temp_tmtCool") %>%
  dplyr::select(estimate)
```




Now, use the character states to calculate estimated rates of change per day for each tmt group:

```{r}
response_per_day <- tmt_matrix %>%
  mutate(CEWL_per_day = CEWL_day_n[[1]] + 
           CEWL_day_n_humidity_tmtDry[[1]]*humid_state + 
           CEWL_day_n_temp_tmtCool[[1]]*temp_state +
           CEWL_day_n_humidity_tmtDry_temp_tmtCool[[1]]*humid_state*temp_state,
         osml_per_day = osml_day_n[[1]] +
           osml_day_n_temp_tmtCool[[1]]*temp_state,
         hct_per_day = hct_day_n[[1]] + 
           hct_day_n_temp_tmtCool[[1]]*temp_state,
         SMI_per_day = SMI_day_n[[1]] + 
           SMI_day_n_humidity_tmtDry[[1]]*humid_state + 
           SMI_day_n_temp_tmtCool[[1]]*temp_state +
           SMI_day_n_humidity_tmtDry_temp_tmtCool[[1]]*humid_state*temp_state)
response_per_day
write.csv(response_per_day, "./results_statistics/exp_change_per_day.csv")
```








# Rehydration Models


## SMI


```{r best SMI rehydration models}
SMI_rmod_best1 <- lmerTest::lmer(data = dat_for_rehab,
                       SMI ~  type + 
                         (1|trial_number/individual_ID))
summary(SMI_rmod_best1)
```



## Hematocrit



```{r best hct rehydration models}
hct_rmod_best1 <- lmerTest::lmer(data = dat_for_rehab,
                       hematocrit_percent ~ 
                         type + 
                         (1|trial_number/individual_ID))
summary(hct_rmod_best1)
```




## Osmolality



```{r best osml rehydration model}
osml_rmod_best1 <- lmerTest::lmer(data = dat_for_rehab,
                       osmolality_mmol_kg_mean ~
                         type + 
                         (1|trial_number/individual_ID))
summary(osml_rmod_best1)
```



## Group Export


```{r best rehydration models all vars}
rehydration_stats <- broom.mixed::tidy(osml_rmod_best1) %>%
  rbind(broom.mixed::tidy(hct_rmod_best1)) %>%
  rbind(broom.mixed::tidy(SMI_rmod_best1)) %>%
  mutate(response = c(rep("Plasma Osmolality (mmol/kg)", 5),
                      rep("Hematocrit (%)", 5),
                      rep("Body Condition (g)", 5)))
write.csv(rehydration_stats, 
          "./results_statistics/rehydration_best_models.csv")
```













# Figures

## Means to Overlay

mean values per day per tmt group:

```{r means}
means <- dat %>% # use whole dat because want for both exp and rehyd
  group_by(day_n, tmt) %>%
  summarise(n_lizards = n(),
            mean_CEWL = mean(CEWL_g_m2h_mean, na.rm = T),
            sd_CEWL = sd(CEWL_g_m2h_mean, na.rm = T),
            mean_osml = mean(osmolality_mmol_kg_mean, na.rm = T),
            sd_osml = sd(osmolality_mmol_kg_mean, na.rm = T),
            mean_hct = mean(hematocrit_percent, na.rm = T),
            sd_hct = sd(hematocrit_percent, na.rm = T),
            mean_SMI = mean(SMI, na.rm = T),
            sd_SMI = sd(SMI, na.rm = T)) %>%
  mutate(se_CEWL = (sd_CEWL/sqrt(n_lizards)),
         se_osml = (sd_osml/sqrt(n_lizards)),
         se_hct = (sd_hct/sqrt(n_lizards)),
         se_SMI = (sd_SMI/sqrt(n_lizards)))
means$mean_CEWL[is.nan(means$mean_CEWL)] <- NA
means$mean_osml[is.nan(means$mean_osml)] <- NA
means$mean_hct[is.nan(means$mean_hct)] <- NA
means$mean_SMI[is.nan(means$mean_SMI)] <- NA
means

# make only for days 0,8,10 for points to plot
pt_means <- means %>%
  dplyr::filter(day_n %in% c(0,4,8,10))

end_means <- means %>%
  dplyr::filter(day_n == 8)
write.csv(end_means, "./results_statistics/exp_end_means.csv")
```


## SMI 

### Ind + Means

```{r SMI actual fig}
ggplot() + 
  geom_line(data = dat,
            aes(x = day_n,
                y = SMI, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = pt_means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme_classic() + 
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("Day") + 
  ylab("Body Condition (g)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0.1, #top
                             0.1, #right
                             0.1, #bottom
                             0.41 #left
                             ), "cm")) -> SMI_fig
SMI_fig
#ggsave(filename = "SMI_fig1.jpeg",
 #      plot = SMI_fig,
  #     path = "./results_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 6, height = 6)
```

### Means Only

```{r SMI actual-min fig}
ggplot() + 
  #plot these first so they end up on the "bottom"
  geom_errorbar(data = means,
                  aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                group = tmt,
                ymin = mean_SMI-se_SMI, 
                ymax = mean_SMI+se_SMI),
                width = .1,
                #position=position_dodge(.01),
                alpha = 0.7) +
  geom_line(data = means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                #linetype = tmt,
                group = tmt),
            alpha = 1, 
            size = 0.5) +
  geom_point(data = means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                #fill = tmt,
                shape = tmt),
            fill = "white",
            alpha = 1, 
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  #scale_linetype_manual(values = c("solid", "longdash", "solid", "longdash"), 
   #                     name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(seq(8,12)),
                     limits = c(8.5,12.5)) +
  xlab("Day") + 
  ylab("Body Condition (g)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none"
) -> SMI_fig_min
SMI_fig_min
```



### LM + SE

```{r mass prez version}
ggplot() + 
  geom_smooth(data = dat_no_rehab,
              aes(x = day_n,
                  y = mass_g, 
                  color = tmt,
                  group = tmt),
              formula = y ~ x, 
              method = "lm", 
              se = T, 
              size = 1.2, 
              alpha = 0.2) + 
  theme_classic() + 
  #scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(limits = c(0,8),
                     breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("Acclimation Day") + 
  ylab("Lizard Mass (g)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none"
) -> SMI_lm_fig
SMI_lm_fig
```


### Ending Values Boxplot

```{r SMI ending vals}
end_vals_SMI <- dat %>%
  dplyr::filter(day_n == 8) %>%
  dplyr::filter(complete.cases(SMI))

SMI_aov <- summary(aov(data = end_vals_SMI, 
             SMI ~ temp_tmt * humidity_tmt))
SMI_tukey <- TukeyHSD(aov(data = end_vals_SMI, 
             SMI ~ temp_tmt * humidity_tmt))

ggplot(data = end_vals_SMI) +
  geom_boxplot(aes(x = tmt,
                   y = SMI, 
                   color = tmt), 
               size = 0.5,
               outlier.shape = NA) + 
  geom_jitter(aes(x = tmt,
                   y = SMI, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
              #fill = "white",
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = end_means, 
             aes(x = tmt,
                   y = mean_SMI, 
                   color = tmt,
                 fill = tmt), 
               size = 3,
             shape = 23) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_y_continuous(limits = c(7,15),
                     breaks = c(seq(7,15, by = 2)),
                     labels = c(seq(7,15, by = 2))) +
  xlab("") + 
  annotate(geom = "text", x = 2, y = 13.8, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 12.3, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 14.3, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 14.5, label = "B", 
           size = 3) +
  ylab("Body Condition (g)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              3.4), "mm")
        ) -> SMI_end_boxplot
SMI_end_boxplot
```





## Hct 

### Ind + Means

```{r hct actual fig}
ggplot() +
  geom_line(data = dat[complete.cases(dat$hematocrit_percent),],
            aes(x = day_n,
                y = hematocrit_percent, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means[complete.cases(means$mean_hct),],
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = pt_means,
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme_classic() + 
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("") + 
  ylab("Hematocrit (%)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0.1, #top
                             0.1, #right
                             0.1, #bottom
                             0.41 #left
                             ), "cm")
        ) -> hct_fig
hct_fig
```



### Means Only

```{r hct actual-minimal fig}
ggplot() +
  geom_errorbar(data = means[complete.cases(means$mean_hct),],
                  aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                group = tmt,
                ymin = mean_hct-se_hct, 
                ymax = mean_hct+se_hct),
                width = .1,
                #position=position_dodge(.1),
                alpha = 0.7) +
  geom_line(data = means[complete.cases(means$mean_hct),],
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                #linetype = tmt,
                group = tmt),
            alpha = 1, 
            size = 0.5) +
  geom_point(data = pt_means,
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                #fill = tmt,
                shape = tmt),
            alpha = 1, 
            fill = "white",
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  #scale_linetype_manual(values = c("solid", "longdash", "solid", "longdash"), 
   #                     name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(25, 30, 35, 40),
                     limits = c(23,42)) +
  xlab("") + 
  ylab("Hematocrit (%)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none"
        ) -> hct_fig_min
hct_fig_min
```



### Ending Values Boxplot


```{r hct ending vals}
end_vals_hct <- dat %>%
  dplyr::filter(day_n == 8) %>%
  dplyr::filter(complete.cases(hematocrit_percent))

hct_aov <- summary(aov(data = end_vals_hct, 
             hematocrit_percent ~ temp_tmt * humidity_tmt))
hct_tukey <- TukeyHSD(aov(data = end_vals_hct, 
             hematocrit_percent ~ temp_tmt * humidity_tmt))

ggplot(data = end_vals_hct) +
  geom_boxplot(aes(x = tmt,
                   y = hematocrit_percent, 
                   color = tmt), 
               size = 0.5,
               outlier.shape = NA) + 
  geom_jitter(aes(x = tmt,
                   y = hematocrit_percent, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = end_means, 
             aes(x = tmt,
                   y = mean_hct, 
                   color = tmt,
                 fill = tmt), 
               size = 3,
             shape = 23) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  xlab("") + 
  scale_y_continuous(limits = c(10,55),
                     breaks = c(seq(10,50, by = 10)),
                     labels = c(seq(10,50, by = 10))) +
  annotate(geom = "text", x = 2, y = 42, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 45, label = "AB", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 53, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 53, label = "B", 
           size = 3) +
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              2.24), "mm")
        ) -> hct_end_boxplot
hct_end_boxplot
```




## Osml 

### Ind + Means


```{r osmolality actual fig}
ggplot() + 
  geom_line(data = dat[complete.cases(dat$osmolality_mmol_kg_mean),],
            aes(x = day_n,
                y = osmolality_mmol_kg_mean, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means[complete.cases(means$mean_osml),],
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = pt_means,
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  ylim(300,450) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("") + 
  ylab("Plasma Osmolality (mmol/kg)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme_classic() +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0.6, #top
                             0.1, #right
                             0.1, #bottom
                             0.1 #left
                             ), "cm")
        ) -> osml_fig
osml_fig
```


### Means Only


```{r osmolality actual-minimal fig}
ggplot() + 
  geom_errorbar(data = means,
                  aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                group = tmt,
                ymin = mean_osml-se_osml, 
                ymax = mean_osml+se_osml),
                width = .1,
                #position=position_dodge(.1),
                alpha = 0.7) +
  geom_line(data = means[complete.cases(means$mean_osml),],
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                #linetype = tmt,
                group = tmt),
            alpha = 1, 
            size = 0.5) +
  geom_point(data = pt_means,
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                #fill = tmt,
                shape = tmt),
            fill = "white",
            alpha = 1, 
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  #scale_linetype_manual(values = c("solid", "longdash", "solid", "longdash"), 
   #                     name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(seq(320,400, by = 10)),
                     limits = c(340,380)) +
  xlab("") + 
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none"
        ) -> osml_fig_min
osml_fig_min
```


### Stats! Check Pairwise Diffs ~ Time

Since Plasma osmolality has such a nonlinear trend, we need to test whether the elevated values in the middle of the experiment are significantly different than the values taken before and/or after.

```{r}
# first make sub-dfs for each tmt group
HH <- dat_no_rehab %>%
  dplyr::filter(tmt == "Hot Humid")
HD <- dat_no_rehab %>%
  dplyr::filter(tmt == "Hot Dry")
CH <- dat_no_rehab %>%
  dplyr::filter(tmt == "Cool Humid")
CD <- dat_no_rehab %>%
  dplyr::filter(tmt == "Cool Dry")

# next do pairwise tests for osml on the diff exp days, for each tmt group
pair_HH <- TukeyHSD(aov(data = HH, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
pair_HD <- TukeyHSD(aov(data = HD, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
pair_CH <- TukeyHSD(aov(data = CH, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
pair_CD <- TukeyHSD(aov(data = CD, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
```

nope, none of the differences between days within tmt groups are significantly different 


### LM + SE


```{r osmolality lm fig}
ggplot() + 
  stat_smooth(data = dat_no_rehab,
              aes(x = day_n,
                  y = osmolality_mmol_kg_mean, 
                  color = tmt,
                  fill = tmt,
                  group = tmt),
              formula = y ~ x, 
              method = "lm", 
              se = T, 
              size = 2, 
              alpha = 0.1) + 
  theme_classic() + 
  #scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(limits = c(0,8), 
                     breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  scale_fill_brewer(palette = "Set2", name = "") +
  xlab("Acclimation Day") + 
  #ylim(340,370) + #CANNOT put ylimits in bc gets rid of pts that are used to make lines
  ylab("Plasma Osmolality\n(mmol/kg)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 30),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 20),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none"
        ) -> osml_lm_fig
osml_lm_fig
```



### Ending Values Boxplot

```{r osml ending vals}
end_vals_osml <- dat %>%
  dplyr::filter(day_n == 8) %>%
  dplyr::filter(complete.cases(osmolality_mmol_kg_mean))

osml_aov <- summary(aov(data = end_vals_osml, 
             osmolality_mmol_kg_mean ~ temp_tmt * humidity_tmt))
osml_tukey <- TukeyHSD(aov(data = end_vals_osml, 
             osmolality_mmol_kg_mean ~ temp_tmt * humidity_tmt))

ggplot(data = end_vals_osml) +
  geom_boxplot(aes(x = tmt,
                   y = osmolality_mmol_kg_mean, 
                   color = tmt), 
               size = 0.5,
               outlier.shape = NA) + 
  geom_jitter(aes(x = tmt,
                   y = osmolality_mmol_kg_mean, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = end_means, 
             aes(x = tmt,
                   y = mean_osml, 
                   color = tmt,
                 fill = tmt), 
               size = 3,
             shape = 23) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_y_continuous(limits = c(290,470),
                     breaks = c(seq(300,450, by = 50)),
                     labels = c(seq(300,450, by = 50))) +
  xlab("") + 
  annotate(geom = "text", x = 2, y = 445, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 420, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 465, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 430, label = "A", 
           size = 3) +
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              0), "mm")
        ) -> osml_end_boxplot
osml_end_boxplot
```



## CEWL

### Ind + Means


```{r CEWL actual fig}
ggplot() + 
  geom_line(data = dat[complete.cases(dat$CEWL_g_m2h_mean),],
            aes(x = day_n,
                y = CEWL_g_m2h_mean, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means[complete.cases(means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = pt_means[complete.cases(pt_means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  theme_classic() + 
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("Day") + 
  ylim(0,60) +
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "bottom"
        #legend.position = c(0.25,0.85)
        ) -> CEWL_fig
CEWL_fig
#ggsave(filename = "CEWL_fig1.jpeg",
 #      plot = CEWL_fig,
  #     path = "./results_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 6, height = 6)
```



### Means Only

```{r CEWL actual fig minimal}
ggplot() + 
  geom_errorbar(data = means[complete.cases(means$mean_CEWL),],
                  aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                group = tmt,
                ymin = mean_CEWL-se_CEWL, 
                ymax = mean_CEWL+se_CEWL),
                width = .1,
                #position=position_dodge(.1),
                alpha = 0.7) +
  geom_line(data = means[complete.cases(means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                #linetype = tmt,
                group = tmt),
            alpha = 1, 
            size = .5) +
  geom_point(data = pt_means[complete.cases(pt_means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                shape = tmt),
            fill = "white",
            alpha = 1, 
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  #scale_linetype_manual(values = c("solid", "longdash", "solid", "longdash"), 
   #                     name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_y_continuous(breaks = c(20, 25, 30, 35, 40),
                     limits = c(18,40)) +
  xlab("Day") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none"
        #legend.position = c(0.25,0.85)
        ) -> CEWL_fig_min
CEWL_fig_min

# use ggarrange so legend is centered
CEWL_fig_formatted <- ggarrange(CEWL_fig_min,
                                ncol = 1, nrow = 1,
                                common.legend = TRUE,
                                legend = "bottom")
# save
ggsave(filename = "experiment_CEWL_fig.pdf",
       plot = CEWL_fig_formatted,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 80)

```




### LM + SE


```{r CEWL lm fig}
ggplot() + 
  stat_smooth(data = dat,
              aes(x = day_n,
                  y = CEWL_g_m2h_mean, 
                  color = tmt,
                  fill = tmt,
                  group = tmt),
              formula = y ~ x, 
              method = "lm", 
              se = T, 
              size = 2, 
              alpha = 0.2) + 
  theme_classic() + 
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  scale_fill_brewer(palette = "Set2", name = "") +
  xlab("Acclimation Day") + 
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 30),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 20),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none"
        #legend.position = c(0.25,0.85)
        ) -> CEWL_lm_fig
CEWL_lm_fig
```




### Ending Values Boxplot

```{r}
end_vals_CEWL <- dat %>%
  dplyr::filter(day_n == 8) %>%
  dplyr::filter(complete.cases(CEWL_g_m2h_mean))

CEWL_tukey <- TukeyHSD(aov(data = end_vals_CEWL, 
             CEWL_g_m2h_mean ~ temp_tmt * humidity_tmt))


ggplot(data = end_vals_CEWL) +
  geom_boxplot(aes(x = tmt,
                   y = CEWL_g_m2h_mean, 
                   color = tmt), 
               size = 0.5,
               outlier.shape = NA) + 
  geom_jitter(aes(x = tmt,
                   y = CEWL_g_m2h_mean, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_point(data = end_means, 
             aes(x = tmt,
                   y = mean_CEWL, 
                   color = tmt,
                 fill = tmt), 
               size = 3,
             shape = 23) +
  theme_classic() + 
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_y_continuous(limits = c(9,63),
                     breaks = c(seq(10,60, by = 10)),
                     labels = c(seq(10,60, by = 10))) +
  xlab("") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) + 
  annotate(geom = "text", x = 2, y = 61, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 48, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 49, label = "C", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 39, label = "B", 
           size = 3) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 12),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              0), "mm")
        ) -> CEWL_end_boxplot
CEWL_end_boxplot
```





## Multi-Figures

over time:

```{r arrange figs}
ggarrange(osml_fig_min, #osml_fig_min, osml_predict_fig,
          hct_fig_min, #hct_fig_min, hct_predict_fig,
          SMI_fig_min, #SMI_fig_min, SMI_predict_fig,
          ncol = 1, nrow = 3,
          labels = c("A", "B", "C"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> experiment_multi_fig
#experiment_multi_fig
# export figure
ggsave(filename = "experiment_multi_fig.pdf",
       plot = experiment_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 210)
```


end values:

```{r}
ggarrange(CEWL_end_boxplot, 
          osml_end_boxplot, 
          hct_end_boxplot,
          SMI_end_boxplot, 
          ncol = 2, nrow = 2,
          labels = c("A", "B", "C", "D"),
          common.legend = FALSE
          ) -> ending_values_multi_fig
#ending_values_multi_fig

ggsave(filename = "exp_end_val_multi_fig.pdf",
       plot = ending_values_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 180, height = 150)
```













