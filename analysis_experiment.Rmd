---
title: "Climate Water Loss Experiment - Treatment Hydration Analysis"
author: "Savannah Weaver"
date: "2021"
output: pdf_document
toc: TRUE
---

# Packages


```{r setup, include = TRUE, message = FALSE}
`%nin%` = Negate(`%in%`)
if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse") # workflow and plots
if (!require("lme4")) install.packages("lme4")
library("lme4") # for LMMs
if (!require("lmerTest")) install.packages("lmerTest")
library("lmerTest") # for p-values
if (!require("ggpubr")) install.packages("ggpubr")
library("ggpubr") # for multi-ggplot figs
if (!require("UsingR")) install.packages("UsingR")
library("UsingR") # simple.eda model assumption checker
if (!require("broom.mixed")) install.packages("broom.mixed")
library("broom.mixed") # lmer model export
if (!require("emmeans")) install.packages('emmeans')
library('emmeans')
if (!require("car")) install.packages("car")
library("car") # VIFs
if (!require("AICcmodavg")) install.packages("AICcmodavg")
library("AICcmodavg") # model selection
if (!require("MuMIn")) install.packages("MuMIn")
library("MuMIn") # model selection
if (!require("RColorBrewer")) install.packages("RColorBrewer")
library("RColorBrewer") # color
```


# Background and Goals

This data was collected June - August by Master's student Savannah Weaver, advisor Dr. Emily Taylor, and research assistants Tess McIntyre and Taylor Van Rossum. Adult male *Sceloporus occidentalis* were caught across the Cal Poly campus then acclimated to 4 different climate treatments. **This R file analyzes the effect of experimental climate treatments on lizard body condition, osmotic balance, and osmoregulation.** Please refer to the published scientific journal article for full details.


# Data

## Load

Read-in data that was compiled, formatted, and checked for completeness in 'wrangling_general'. See that file for information related to the variables.

```{r load data}
dat <- read_rds("./data/analysis_data_experiment.RDS") %>%
  # add VPD values by tmt and trial group
  left_join(read_rds("./data/HOBO_tmt_trial_diffs.RDS"), 
            by = c('tmt', 'trial_number'='trial')) %>%
  # add the per tmt group calculation of VPD from analysis_HOBO
  mutate(VPD_kPa = case_when(substr(tmt, 1, 6) == "Hot Dr" ~ 3.82,
                             substr(tmt, 1, 6) == "Hot Hu" ~ 1.07,
                             substr(tmt, 1, 6) == "Cool D" ~ 2.50,
                             substr(tmt, 1, 6) == "Cool H" ~ 0.64))
summary(dat)
```





## Split

Make sub-dataframes without recovery data / with only recovery-related data:

```{r sub-dfs}
dat_no_rehab <- dat %>%
  dplyr::filter(day_n %in% c(seq(0,8))) 

recovery_values <- dat %>%
  dplyr::filter(day_n == 10) %>%
  dplyr::select(individual_ID,
                end_hct = hematocrit_percent,
                end_osml = osmolality_mmol_kg_mean,
                end_SMI = SMI)

recovery_v_post_exp <- dat %>%
  dplyr::filter(day_n == 8) %>%
  left_join(recovery_values, by = 'individual_ID') %>%
  mutate(delta_osml_10_8 = end_osml - osmolality_mmol_kg_mean,
         delta_hct_10_8 = end_hct - hematocrit_percent,
         delta_SMI_10_8 = end_SMI - SMI)
summary(recovery_v_post_exp)

recovery_v_pre_exp <- dat %>%
  dplyr::filter(day_n == 0) %>%
  left_join(recovery_values, by = 'individual_ID') %>%
  mutate(delta_osml_10_0 = end_osml - osmolality_mmol_kg_mean,
         delta_hct_10_0 = end_hct - hematocrit_percent,
         delta_SMI_10_0 = end_SMI - SMI)
summary(recovery_v_pre_exp)
```



## Check

Dates:

```{r check dates}
unique(dat$measurement_date)
```

Number of measurements for each lizard:

```{r check n msmts}
dat_no_rehab %>%
  group_by(individual_ID) %>%
  summarise(n = n()) %>%
  arrange(n)
```


Every lizard has 6 experimental measurements: pre-tmt, mid-tmt, post-tmt, and mass checks on each of the 3 days between mid and post-tmt.


Did any of the treatment groups inherently start out with large differences in response variables?


```{r check starting diffs}
dat %>%
  dplyr::filter(day_n == 0) %>%
  group_by(tmt) %>%
  summarise(mean(mass_g),
            sd(mass_g),
            mean(SMI),
            mean(hematocrit_percent),
            mean(osmolality_mmol_kg_mean),
            mean(CEWL_g_m2h_mean))
```

There are slight differences, but overall the starting values across groups are more or less the same.


Temp & RH during (all, before and after exp) CEWL measurements:

```{r}
summary(dat_no_rehab)
dat_no_rehab %>%
  group_by(type) %>%
  summarise(mean(msmt_temp_C, na.rm = T),
            sd(msmt_temp_C, na.rm = T),
            mean(msmt_RH_percent, na.rm = T),
            sd(msmt_RH_percent, na.rm = T),
            mean(msmt_VPD_kPa, na.rm = T),
            mean(msmt_VPD_kPa, na.rm = T))
```



## Means by Day

Calculate mean values per day per tmt group.

```{r means}
means <- dat %>% # use whole dat because want for both exp and rehyd
  group_by(day_n, tmt) %>%
  summarise(n_lizards = n(),
            mean_CEWL = mean(CEWL_g_m2h_mean, na.rm = T),
            sd_CEWL = sd(CEWL_g_m2h_mean, na.rm = T),
            mean_osml = mean(osmolality_mmol_kg_mean, na.rm = T),
            sd_osml = sd(osmolality_mmol_kg_mean, na.rm = T),
            mean_hct = mean(hematocrit_percent, na.rm = T),
            sd_hct = sd(hematocrit_percent, na.rm = T),
            mean_SMI = mean(SMI, na.rm = T),
            sd_SMI = sd(SMI, na.rm = T)) %>%
  mutate(se_CEWL = (sd_CEWL/sqrt(n_lizards)),
         se_osml = (sd_osml/sqrt(n_lizards)),
         se_hct = (sd_hct/sqrt(n_lizards)),
         se_SMI = (sd_SMI/sqrt(n_lizards)))

# get rid of non-defined points
means$mean_CEWL[is.nan(means$mean_CEWL)] <- NA
means$mean_osml[is.nan(means$mean_osml)] <- NA
means$mean_hct[is.nan(means$mean_hct)] <- NA
means$mean_SMI[is.nan(means$mean_SMI)] <- NA
means

# get only means for the very end
end_means <- means %>%
  dplyr::filter(day_n == 8)
#write.csv(end_means, "./results_statistics/exp_end_means.csv")
```


## End Values Only

Select for only day=8 values.

```{r}
end_vals <- dat %>%
  dplyr::filter(day_n == 8)
```


## delta CEWL

Get a df that only has complete observations that include CEWL values (only obs from before and after the experiment). Then, calculate the CHANGE (delta) in CEWL from before to after the experiment. Because we only measured CEWL at those two time points, it makes more sense to assess the **amount of change** in CEWL for each lizard, rather than measuring the change over time.

```{r}
start_CEWL <- dat_no_rehab %>%
  dplyr::filter(day_n == 0) %>%
  dplyr::select(individual_ID, start_CEWL = CEWL_g_m2h_mean)
dat_no_rehab_deltaCEWL <- dat_no_rehab %>% # initiate new df
  dplyr::filter(complete.cases(CEWL_g_m2h_mean)) %>% # only use obs incl CEWL
  dplyr::filter(day_n == 8) %>% # get only obs for post-exp
  left_join(start_CEWL, by = 'individual_ID') %>% # add start CEWL to both obs for each lizard
  mutate(delta_CEWL = CEWL_g_m2h_mean - start_CEWL) # calculate deltaCEWL after-before experiment
```



# Experiment Models

We predicted that there would be effects of day, humidity treatment, temperature treatment, and treatment VPD. However, we can't use the standard backwards model selection because the three treatment variables are collinear (VIF much higher than acceptable) and it leads to issues with changing the sign of the estimates when all three are included together. So, we will run singular models with each treatment variable alone:

response ~ day*humidity
response ~ day*temperature
response ~ day*VPD

Then, we will use AIC, RMSE, and R-sq to assess which treatment effect is most important to that response variable.


## Body Condition

### Building

Build each treatment effect model.

```{r SMI exp models}
SMI_mod_VPD <- lmerTest::lmer(data = dat_no_rehab,
                              SMI ~ day_n * VPD_kPa +
                              (1|trial_number/individual_ID))
SMI_mod_hum <- lmerTest::lmer(data = dat_no_rehab,
                              SMI ~ day_n * humidity_tmt +
                              (1|trial_number/individual_ID))
SMI_mod_temp <- lmerTest::lmer(data = dat_no_rehab,
                              SMI ~ day_n * temp_tmt +
                              (1|trial_number/individual_ID))
```



### Assumptions

Check linear regression assumptions/conditions.

```{r SMI exp model assumptions}
# distribution of SMI
hist(dat_no_rehab$SMI)

# VPD model
plot(SMI_mod_VPD)
simple.eda(residuals(SMI_mod_VPD))
shapiro.test(residuals(SMI_mod_VPD))

# humidity model
plot(SMI_mod_hum)
simple.eda(residuals(SMI_mod_hum))
shapiro.test(residuals(SMI_mod_hum))

# temperature model
plot(SMI_mod_temp)
simple.eda(residuals(SMI_mod_temp))
shapiro.test(residuals(SMI_mod_temp))
```


Normality is violated, but linearity, equal error variance, and independence are all good.


### Comparison

Now, compare the AIC, RMSE, and R^2 values across models, and the F and p values of the variables for each model.

We... 
calculate RMSE manually, 
use the r.squaredGLMM function in the MuMIn package to get the marginal R^2, which is how much of the total variance is explained by fixed effects, 
use the aictab function in the AICmodavg package to get AIC and deltaAIC values, and
get the sum of squares, F, and p-values for each variable from the anova table for each model.

```{r SMI mod compare}
# calculate RMSE & R^2
SMI_RMSE_Rsq <- data.frame(model = 
                               c('Day * VPD',
                                 'Day * Humidity',
                                 'Day * Temp'
                                 ),
                           RMSE = c(sqrt(mean((residuals(SMI_mod_VPD))^2)),
                                    sqrt(mean((residuals(SMI_mod_hum))^2)),
                                    sqrt(mean((residuals(SMI_mod_temp))^2))),
                           # marginal Rsq for the amount of variance
                           # explained by fixed effects only
                           Rsq = c(MuMIn::r.squaredGLMM(SMI_mod_VPD)[,"R2m"],
                                   MuMIn::r.squaredGLMM(SMI_mod_hum)[,"R2m"],
                                   MuMIn::r.squaredGLMM(SMI_mod_temp)[,"R2m"]))

# calculate AIC
SMI_models <- list(SMI_mod_VPD, SMI_mod_hum, SMI_mod_temp)
EXP_mod_names <- data.frame(model = 
                               c('Day * VPD',
                                 'Day * Humidity',
                                 'Day * Temp'
                                 ))
SMI_AICc <- data.frame(aictab(cand.set = SMI_models, 
                                 modnames = EXP_mod_names))

# compare across models
SMI_across <- SMI_RMSE_Rsq %>%
  left_join(SMI_AICc, by = 'model') %>%
  mutate(response = "Body Condition (g')") %>%
  arrange(Delta_AICc)

# calculate F & p-values
SMI_VPD_p <- data.frame(anova(SMI_mod_VPD, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * VPD',
         predictor = rownames(.))
SMI_hum_p <- data.frame(anova(SMI_mod_hum, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * Humidity',
         predictor = rownames(.))
SMI_temp_p <- data.frame(anova(SMI_mod_temp, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * Temp',
         predictor = rownames(.))

# save within model values
SMI_within <- SMI_VPD_p %>%
  rbind(SMI_hum_p) %>%
  rbind(SMI_temp_p) %>%
  mutate(df = paste((NumDF), round(DenDF, 0), sep = ", "),
         response = "Body Condition (g')")
```







## Hematocrit

### Building

Build each treatment effect model.

```{r hct exp models}
hct_mod_VPD <- lmerTest::lmer(data = dat_no_rehab,
                               hematocrit_percent ~ day_n * VPD_kPa +
                              (1|trial_number/individual_ID))
hct_mod_hum <- lmerTest::lmer(data = dat_no_rehab,
                              hematocrit_percent ~ day_n * humidity_tmt +
                              (1|trial_number/individual_ID))
hct_mod_temp <- lmerTest::lmer(data = dat_no_rehab,
                              hematocrit_percent ~ day_n * temp_tmt +
                              (1|trial_number/individual_ID))
```



### Assumptions

Check linear regression assumptions/conditions.

```{r hct exp model assumptions}
# distribution of 
hist(dat_no_rehab$hematocrit_percent)

# VPD model
plot(hct_mod_VPD)
simple.eda(residuals(hct_mod_VPD))
shapiro.test(residuals(hct_mod_VPD))

# humidity model
plot(hct_mod_hum)
simple.eda(residuals(hct_mod_hum))
shapiro.test(residuals(hct_mod_hum))

# temperature model
plot(hct_mod_temp)
simple.eda(residuals(hct_mod_temp))
shapiro.test(residuals(hct_mod_temp))
```


All assumptions, normality, linearity, equal error variance, and independence are all good.


### Comparison

Now, compare the AIC, RMSE, and R^2 values across models, and the F and p values of the variables for each model.

We... 
calculate RMSE manually, 
use the r.squaredGLMM function in the MuMIn package to get the marginal R^2, which is how much of the total variance is explained by fixed effects, 
use the aictab function in the AICmodavg package to get AIC and deltaAIC values, and
get the sum of squares, F, and p-values for each variable from the anova table for each model.

```{r hct mod compare}
# calculate RMSE & R^2
hct_RMSE_Rsq <- data.frame(model = 
                               c('Day * VPD',
                                 'Day * Humidity',
                                 'Day * Temp'
                                 ),
                           RMSE = c(sqrt(mean((residuals(hct_mod_VPD))^2)),
                                    sqrt(mean((residuals(hct_mod_hum))^2)),
                                    sqrt(mean((residuals(hct_mod_temp))^2))),
                           # marginal Rsq for the amount of variance
                           # explained by fixed effects only
                           Rsq = c(MuMIn::r.squaredGLMM(hct_mod_VPD)[,"R2m"],
                                   MuMIn::r.squaredGLMM(hct_mod_hum)[,"R2m"],
                                   MuMIn::r.squaredGLMM(hct_mod_temp)[,"R2m"]))

# calculate AIC
hct_models <- list(hct_mod_VPD, hct_mod_hum, hct_mod_temp)
hct_AICc <- data.frame(aictab(cand.set = hct_models, 
                                 modnames = EXP_mod_names))

# compare across models
hct_across <- hct_RMSE_Rsq %>%
  left_join(hct_AICc, by = 'model') %>%
  mutate(response = "Hematocrit (%)") %>%
  arrange(Delta_AICc)

# calculate F & p-values
hct_VPD_p <- data.frame(anova(hct_mod_VPD, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * VPD',
         predictor = rownames(.))
hct_hum_p <- data.frame(anova(hct_mod_hum, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * Humidity',
         predictor = rownames(.))
hct_temp_p <- data.frame(anova(hct_mod_temp, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * Temp',
         predictor = rownames(.))

# save within model values
hct_within <- hct_VPD_p %>%
  rbind(hct_hum_p) %>%
  rbind(hct_temp_p) %>%
  mutate(df = paste((NumDF), round(DenDF, 0), sep = ", "),
         response = "Hematocrit (%)")
```
 





## Osmolality


### Building

Build each treatment effect model.

```{r osml exp models}
osml_mod_VPD <- lmerTest::lmer(data = dat_no_rehab,
                               osmolality_mmol_kg_mean ~ day_n * VPD_kPa +
                              (1|trial_number/individual_ID))
osml_mod_hum <- lmerTest::lmer(data = dat_no_rehab,
                               osmolality_mmol_kg_mean ~ day_n * humidity_tmt +
                              (1|trial_number/individual_ID))
osml_mod_temp <- lmerTest::lmer(data = dat_no_rehab,
                               osmolality_mmol_kg_mean ~ day_n * temp_tmt +
                              (1|trial_number/individual_ID))
```



### Assumptions

Check linear regression assumptions/conditions.

```{r osml exp model assumptions}
# distribution of 
hist(dat_no_rehab$osmolality_mmol_kg_mean)

# VPD model
plot(osml_mod_VPD)
simple.eda(residuals(osml_mod_VPD))
shapiro.test(residuals(osml_mod_VPD))

# humidity model
plot(osml_mod_hum)
simple.eda(residuals(osml_mod_hum))
shapiro.test(residuals(osml_mod_hum))

# temperature model
plot(osml_mod_temp)
simple.eda(residuals(osml_mod_temp))
shapiro.test(residuals(osml_mod_temp))
```


Normality is violated, but linearity, equal error variance, and independence are all okay.


### Comparison

Now, compare the AIC, RMSE, and R^2 values across models, and the F and p values of the variables for each model.

We... 
calculate RMSE manually, 
use the r.squaredGLMM function in the MuMIn package to get the marginal R^2, which is how much of the total variance is explained by fixed effects, 
use the aictab function in the AICmodavg package to get AIC and deltaAIC values, and
get the sum of squares, F, and p-values for each variable from the anova table for each model.

```{r osml mod compare}
# calculate RMSE & R^2
osml_RMSE_Rsq <- data.frame(model = 
                               c('Day * VPD',
                                 'Day * Humidity',
                                 'Day * Temp'
                                 ),
                           RMSE = c(sqrt(mean((residuals(osml_mod_VPD))^2)),
                                    sqrt(mean((residuals(osml_mod_hum))^2)),
                                    sqrt(mean((residuals(osml_mod_temp))^2))),
                           # marginal Rsq for the amount of variance
                           # explained by fixed effects only
                           Rsq = c(MuMIn::r.squaredGLMM(osml_mod_VPD)[,"R2m"],
                                   MuMIn::r.squaredGLMM(osml_mod_hum)[,"R2m"],
                                   MuMIn::r.squaredGLMM(osml_mod_temp)[,"R2m"]))

# calculate AIC
osml_models <- list(osml_mod_VPD, osml_mod_hum, osml_mod_temp)
osml_AICc <- data.frame(aictab(cand.set = osml_models, 
                                 modnames = EXP_mod_names))

# compare across models
osml_across <- osml_RMSE_Rsq %>%
  left_join(osml_AICc, by = 'model') %>%
  mutate(response = "Plasma Osmolality (mmol/kg)") %>%
  arrange(Delta_AICc)

# calculate F & p-values
osml_VPD_p <- data.frame(anova(osml_mod_VPD, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * VPD',
         predictor = rownames(.))
osml_hum_p <- data.frame(anova(osml_mod_hum, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * Humidity',
         predictor = rownames(.))
osml_temp_p <- data.frame(anova(osml_mod_temp, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Day * Temp',
         predictor = rownames(.))

# save within model values
osml_within <- osml_VPD_p %>%
  rbind(osml_hum_p) %>%
  rbind(osml_temp_p) %>%
  mutate(df = paste((NumDF), round(DenDF, 0), sep = ", "),
         response = "Plasma Osmolality (mmol/kg)")
```




## Body Temp

I need to double check whether CEWL has a relationship with body temperature at the point of measurement.

```{r}
ggplot(dat_no_rehab) + 
  geom_point(aes(x = CEWL_g_m2h_mean,
                 y = cloacal_temp_C,
                 color = day_n))
```

Test an lm of raw CEWL ~ body temp for day 8 measurements only.

```{r}
body_temp_test_dat <- dat_no_rehab_deltaCEWL %>%
  dplyr::filter(complete.cases(CEWL_g_m2h_mean)) %>%
  dplyr::filter(day_n == 8)

CEWL_body_temp_mod <- lmerTest::lmer(data = body_temp_test_dat, 
                         CEWL_g_m2h_mean ~ cloacal_temp_C * tmt +
                           (1|trial_number))
summary(CEWL_body_temp_mod)
anova(CEWL_body_temp_mod, type = "1", ddf = "Kenward-Roger")
```


```{r}
ggplot(body_temp_test_dat) + 
  geom_point(aes(x = msmt_temp_C,
                 y = cloacal_temp_C)) +
  xlim(23, 28) + ylim(23,28)
ggplot(body_temp_test_dat) + 
  geom_point(aes(x = msmt_temp_C,
                 y = CEWL_g_m2h_mean,
                 color = tmt))
```





## CEWL



### t-tests

```{r}
CEWL_ttest_HH <- t.test(HH_temp$delta_CEWL, 
                        mu = 0, alternative = "two.sided")
CEWL_ttest_HH

CEWL_ttest_HD <- t.test(HD_temp$delta_CEWL, 
                        mu = 0, alternative = "two.sided")
CEWL_ttest_HD

CEWL_ttest_CH <- t.test(CH_temp$delta_CEWL, 
                        mu = 0, alternative = "two.sided")
CEWL_ttest_CH

CEWL_ttest_CD <- t.test(CD_temp$delta_CEWL, 
                        mu = 0, alternative = "two.sided")
CEWL_ttest_CD
```




### Building

Build each treatment effect model.

```{r CEWL exp models}
CEWL_mod_VPD <- lmerTest::lmer(data = dat_no_rehab_deltaCEWL,
                               delta_CEWL ~ VPD_kPa +
                              (1|trial_number))
CEWL_mod_hum <- lmerTest::lmer(data = dat_no_rehab_deltaCEWL,
                               delta_CEWL ~ humidity_tmt +
                              (1|trial_number))
CEWL_mod_temp <- lmerTest::lmer(data = dat_no_rehab_deltaCEWL,
                               delta_CEWL ~ temp_tmt +
                              (1|trial_number))
```



### Assumptions

Check linear regression assumptions/conditions.

```{r CEWL exp model assumptions}
# distribution of 
hist(dat_no_rehab_deltaCEWL$delta_CEWL)

# VPD model
plot(CEWL_mod_VPD)
simple.eda(residuals(CEWL_mod_VPD))
shapiro.test(residuals(CEWL_mod_VPD))

# humidity model
plot(CEWL_mod_hum)
simple.eda(residuals(CEWL_mod_hum))
shapiro.test(residuals(CEWL_mod_hum))

# temperature model
plot(CEWL_mod_temp)
simple.eda(residuals(CEWL_mod_temp))
shapiro.test(residuals(CEWL_mod_temp))
```


All assumptions are fine.


### Comparison

Now, compare the AIC, RMSE, and R^2 values across models, and the F and p values of the variables for each model.

We... 
calculate RMSE manually, 
use the r.squaredGLMM function in the MuMIn package to get the marginal R^2, which is how much of the total variance is explained by fixed effects, 
use the aictab function in the AICmodavg package to get AIC and deltaAIC values, and
get the sum of squares, F, and p-values for each variable from the anova table for each model.

```{r CEWL mod compare}
# calculate RMSE & R^2
CEWL_RMSE_Rsq <- data.frame(model = 
                               c('VPD',
                                 'Humidity',
                                 'Temp'
                                 ),
                           RMSE = c(sqrt(mean((residuals(CEWL_mod_VPD))^2)),
                                    sqrt(mean((residuals(CEWL_mod_hum))^2)),
                                    sqrt(mean((residuals(CEWL_mod_temp))^2))),
                           # marginal Rsq for the amount of variance
                           # explained by fixed effects only
                           Rsq = c(MuMIn::r.squaredGLMM(CEWL_mod_VPD)[,"R2m"],
                                   MuMIn::r.squaredGLMM(CEWL_mod_hum)[,"R2m"],
                                   MuMIn::r.squaredGLMM(CEWL_mod_temp)[,"R2m"]))

# calculate AIC
CEWL_models <- list(CEWL_mod_VPD, CEWL_mod_hum, CEWL_mod_temp)
CEWL_mod_names <- data.frame(model = 
                               c('VPD',
                                 'Humidity',
                                 'Temp'
                                 ))
CEWL_AICc <- data.frame(aictab(cand.set = CEWL_models, 
                                 modnames = CEWL_mod_names))

# compare across models
CEWL_across <- CEWL_RMSE_Rsq %>%
  left_join(CEWL_AICc, by = 'model') %>%
  mutate(response = "deltaCEWL") %>%
  arrange(Delta_AICc)

# calculate F & p-values
CEWL_VPD_p <- data.frame(anova(CEWL_mod_VPD, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'VPD',
         predictor = rownames(.))
CEWL_hum_p <- data.frame(anova(CEWL_mod_hum, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Humidity',
         predictor = rownames(.))
CEWL_temp_p <- data.frame(anova(CEWL_mod_temp, 
                              type = "1", 
                              ddf = "Kenward-Roger")) %>%
  mutate(model = 'Temp',
         predictor = rownames(.))

# save within model values
CEWL_within <- CEWL_VPD_p %>%
  rbind(CEWL_hum_p) %>%
  rbind(CEWL_temp_p) %>%
  mutate(df = paste((NumDF), round(DenDF, 0), sep = ", "),
         response = "deltaCEWL")
```












## Group Export

Put all the model statistics into one df/csv - one for among-model comparisons, and one for within-model stats.

```{r export exp stats}
experiment_model_compare <- CEWL_across %>%
  rbind(osml_across) %>%
  rbind(hct_across) %>%
  rbind(SMI_across) %>%
  dplyr::select(response, model, 
                RMSE, Rsq, AICc, Delta_AICc) %>%
  mutate(RMSE = round(RMSE, 2), 
         Rsq = round(Rsq, 2), 
         AICc = round(AICc, 2), 
         Delta_AICc = round(Delta_AICc, 2)) 
write.csv(experiment_model_compare, 
          "./results_statistics/exp_model_comparisons.csv")

experiment_model_values <- CEWL_within %>%
  rbind(osml_within) %>%
  rbind(hct_within) %>%
  rbind(SMI_within) %>%
  dplyr::select(response, model, predictor, 
                seq_sum_of_squares = Sum.Sq, 
                df, 
                F_statistic = F.value, 
                p_value = Pr..F.) %>%
  mutate(seq_sum_of_squares = round(seq_sum_of_squares, 0), 
         F_statistic = round(F_statistic, 2)) 
write.csv(experiment_model_values, "./results_statistics/exp_model_values.csv")
```





# Effect Estimates 

## End Value CIs

Now, we can use the emmeans function from the emmeans package to estimate marginal means and confidence intervals for the values among treatment groups at the end of the experiment. But, to get for each treatment group, we need to run a new model with day 8 data only and tmt as a single, 4-category variable.

```{r emmeans}
# Body Condition
SMI_mod_end <- lmerTest::lmer(data = end_vals,
                              SMI ~ tmt + 
                              (1|trial_number))
SMI_emmeans <- data.frame(emmeans(SMI_mod_end, "tmt")) %>%
  mutate(response = "Body Condition (g')")
SMI_pairwise <- data.frame(pairs(emmeans(SMI_mod_end, "tmt"))) %>%
  mutate(response = "Body Condition (g')")

# Hematocrit
hct_mod_end <- lmerTest::lmer(data = end_vals,
                              hematocrit_percent ~ tmt + 
                              (1|trial_number))
hct_emmeans <- data.frame(emmeans(hct_mod_end, "tmt")) %>%
  mutate(response = "Hematocrit (%)")
hct_pairwise <- data.frame(pairs(emmeans(hct_mod_end, "tmt"))) %>%
  mutate(response = "Hematocrit (%)")

# Plasma Osmolality
osml_mod_end <- lmerTest::lmer(data = end_vals,
                              osmolality_mmol_kg_mean ~ tmt + 
                              (1|trial_number))
osml_emmeans <- data.frame(emmeans(osml_mod_end, "tmt")) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")
osml_pairwise <- data.frame(pairs(emmeans(osml_mod_end, "tmt"))) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")

# CEWL
CEWL_mod_end <- lmerTest::lmer(data = end_vals,
                              CEWL_g_m2h_mean ~ tmt + 
                              (1|trial_number))
CEWL_emmeans <- data.frame(emmeans(CEWL_mod_end, "tmt")) %>%
  mutate(response = "CEWL (g/m2h)")
CEWL_pairwise <- data.frame(pairs(emmeans(CEWL_mod_end, "tmt"))) %>%
  mutate(response = "CEWL (g/m2h)")

# put together?
# use indiv for boxplots
```



## Rate of Change

```{r emtrends}
# Body Condition
SMI_mod_day <- lmerTest::lmer(data = dat_no_rehab,
                              SMI ~ day_n * tmt + 
                              (1|trial_number/individual_ID))
SMI_emtrends <- data.frame(emtrends(SMI_mod_day, "tmt", var = "day_n")) %>%
  mutate(response = "Body Condition (g')")
SMI_pairtrend <- data.frame(pairs(emtrends(SMI_mod_day, "tmt", var = "day_n"))) %>%
  mutate(response = "Body Condition (g')")

# Hematocrit
hct_mod_day <- lmerTest::lmer(data = dat_no_rehab,
                              hematocrit_percent ~ day_n * tmt + 
                              (1|trial_number/individual_ID))
hct_emtrends <- data.frame(emtrends(hct_mod_day, "tmt", var = "day_n")) %>%
  mutate(response = "Hematocrit (%)")
hct_pairtrend <- data.frame(pairs(emtrends(hct_mod_day, "tmt", var = "day_n"))) %>%
  mutate(response = "Hematocrit (%)")

# Plasma Osmolality
osml_mod_day <- lmerTest::lmer(data = dat_no_rehab,
                              osmolality_mmol_kg_mean ~ day_n * tmt + 
                              (1|trial_number/individual_ID))
osml_emtrends <- data.frame(emtrends(osml_mod_day, "tmt", var = "day_n")) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")
osml_pairtrend <- data.frame(pairs(emtrends(osml_mod_day, "tmt", var = "day_n"))) %>%
  mutate(response = "Plasma Osmolality (mmol/kg)")

# CEWL
CEWL_mod_day <- lmerTest::lmer(data = dat_no_rehab,
                              CEWL_g_m2h_mean ~ day_n * tmt + 
                              (1|trial_number))
CEWL_emtrends <- data.frame(emtrends(CEWL_mod_day, "tmt", var = "day_n")) %>%
  mutate(response = "CEWL (g/m2h)")
CEWL_pairtrend <- data.frame(pairs(emtrends(CEWL_mod_day, "tmt", var = "day_n"))) %>%
  mutate(response = "CEWL (g/m2h)")

# put together
all_emtrends <- CEWL_emtrends %>%
  rbind(osml_emtrends) %>%
  rbind(hct_emtrends) %>%
  rbind(SMI_emtrends) %>%
  mutate(confint95 = paste(round(lower.CL, 2), round(upper.CL, 2), sep = ", ")) %>%
  dplyr::select(response, tmt, 
                per_day_change = day_n.trend,
                confint95,
                SE, df)
#write.csv(all_emtrends, "./results_statistics/exp_emtrends_per_day_change.csv")
```





# CEWL ~ osmolality

First, get a separate df for each tmt group:

```{r}
HH8 <- body_temp_test_dat %>%
  dplyr::filter(substr(tmt, 1, 6) == "Hot Hu")
HD8 <- body_temp_test_dat %>%
  dplyr::filter(substr(tmt, 1, 6) == "Hot Dr")
CH8 <- body_temp_test_dat %>%
  dplyr::filter(substr(tmt, 1, 6) == "Cool H")
CD8 <- body_temp_test_dat %>%
  dplyr::filter(substr(tmt, 1, 6) == "Cool D")
```


Then, run models for CEWL ~ osmolality:

```{r}
HH_CEWL_osml <- lmerTest::lmer(data = HH8, 
                               CEWL_g_m2h_mean ~ osmolality_mmol_kg_mean +
                               (1|trial_number))
summary(HH_CEWL_osml)
anova(HH_CEWL_osml, type = "1", ddf = "Kenward-Roger")

HD_CEWL_osml <- lmerTest::lmer(data = HD8, 
                               CEWL_g_m2h_mean ~ osmolality_mmol_kg_mean +
                               (1|trial_number))
summary(HD_CEWL_osml)
anova(HD_CEWL_osml, type = "1", ddf = "Kenward-Roger")

CH_CEWL_osml <- lmerTest::lmer(data = CH8, 
                               CEWL_g_m2h_mean ~ osmolality_mmol_kg_mean +
                               (1|trial_number))
summary(CH_CEWL_osml)
anova(CH_CEWL_osml, type = "1", ddf = "Kenward-Roger")

CD_CEWL_osml <- lmerTest::lmer(data = CD8, 
                               CEWL_g_m2h_mean ~ osmolality_mmol_kg_mean +
                               (1|trial_number))
summary(CD_CEWL_osml)
anova(CD_CEWL_osml, type = "1", ddf = "Kenward-Roger")
```

Even though only data for one treatment group was significant, all have a positive relationship!


# CEWL ~ VPD

```{r}
CEWL_VPD_lm <- lm(data = dat_no_rehab_deltaCEWL,
                               delta_CEWL ~ VPD_kPa_tmttrial)
plot(CEWL_VPD_lm)
simple.eda(residuals(CEWL_VPD_lm))
shapiro.test(residuals(CEWL_VPD_lm))
summary(CEWL_VPD_lm)
```

Even though the data is slightly nonlinear, a linear model does a fine job explaining the data.

We will double check a comparison of a polynomial model, just to be sure:

```{r}
CEWL_VPD_poly <- lm(data = dat_no_rehab_deltaCEWL,
                               delta_CEWL ~ poly(VPD_kPa_tmttrial, 2))
plot(CEWL_VPD_poly)
simple.eda(residuals(CEWL_VPD_poly))
shapiro.test(residuals(CEWL_VPD_poly))
summary(CEWL_VPD_poly)
```

LINE assumptions are equally-well-met.

The polynomial factor is not significant, but the R-sq is slightly higher for the poly model. 

Compare RMSE and AIC:

```{r}
sqrt(mean((residuals(CEWL_VPD_lm))^2))
sqrt(mean((residuals(CEWL_VPD_poly))^2))

CEWL_VPD_models <- list(CEWL_VPD_lm, CEWL_VPD_poly)
CEWL_VPD_mod_names <- data.frame(model = 
                               c('linear',
                                 'polynomial'
                                 ))
CEWL_VPD_AICc <- data.frame(aictab(cand.set = CEWL_VPD_models, 
                                 modnames = CEWL_VPD_mod_names))
CEWL_VPD_AICc
```

RMSE is slightly lower for the polynomial model. But, AIC is not meaningfully different between the two versions.



I'll use the lm as the best model/

```{r}
summary(CEWL_VPD_lm)
anova(CEWL_VPD_lm)
```

(estimate = -2.96, SE = 0.6, df = (1, 131), F = 24.82, p < 0.0001, Rsq = 0.16)





# Recovery Models

I want to know how the 2-day recovery period affects physiology relative to post- and pre- experiment. To do this, I'll use a two-sided t-test comparing delta to the hypothesis of mu=0.

First, calculate the mean delta and SEM?

```{r}
recovery_v_post_exp_summary <- recovery_v_post_exp %>%
  group_by(type) %>%
  summarise(mean_delta_osml = mean(delta_osml_10_8, na.rm = T),
            mean_delta_hct = mean(delta_hct_10_8, na.rm = T),
            mean_delta_SMI = mean(delta_SMI_10_8, na.rm = T))
```



## SMI


```{r best SMI rehydration models}
SMI_rmod_post_exp <- t.test(recovery_v_post_exp$delta_SMI_10_8, 
                           mu = 0, alternative = "two.sided")
SMI_rmod_post_exp
SMI_rmod_pre_exp <- t.test(recovery_v_pre_exp$delta_SMI_10_0, 
                           mu = 0, alternative = "two.sided")
SMI_rmod_pre_exp
```



## Hematocrit



```{r best hct rehydration models}
hct_rmod_post_exp <- t.test(recovery_v_post_exp$delta_hct_10_8, 
                           mu = 0, alternative = "two.sided")
hct_rmod_post_exp

hct_rmod_pre_exp <- t.test(recovery_v_pre_exp$delta_hct_10_0, 
                           mu = 0, alternative = "two.sided")
hct_rmod_pre_exp
```




## Osmolality



```{r best osml rehydration model}
osml_rmod_post_exp <- t.test(recovery_v_post_exp$delta_osml_10_8, 
                           mu = 0, alternative = "two.sided")
osml_rmod_post_exp

osml_rmod_pre_exp <- t.test(recovery_v_pre_exp$delta_osml_10_0, 
                           mu = 0, alternative = "two.sided")
osml_rmod_pre_exp
```



## Group Export


```{r best rehydration models all vars}
recovery_stats <- broom.mixed::tidy(osml_rmod_pre_exp) %>%
  rbind(broom.mixed::tidy(osml_rmod_post_exp)) %>%
  rbind(broom.mixed::tidy(hct_rmod_pre_exp)) %>%
  rbind(broom.mixed::tidy(hct_rmod_post_exp)) %>%
  rbind(broom.mixed::tidy(SMI_rmod_pre_exp)) %>%
  rbind(broom.mixed::tidy(SMI_rmod_post_exp)) %>%
  mutate(response = c(rep("Plasma Osmolality (mmol/kg)", 2),
                      rep("Hematocrit (%)", 2),
                      rep("Body Condition (g')", 2)),
         pre_post_exp = c(rep(c("pre", "post"), 3)))
write.csv(recovery_stats, 
          "./results_statistics/recovery_stats.csv")
```













# Figures

## Colors & Shapes

```{r}
CH_color <- brewer.pal(4, "Spectral")[c(4)]
HH_color <- brewer.pal(4, "Spectral")[c(2)]
CD_color <- brewer.pal(4, "Spectral")[c(3)]
HD_color <- brewer.pal(4, "Spectral")[c(1)]
my_colors <- c(CH_color, HH_color, CD_color, HD_color)

CH_shp <- 15
HH_shp <- 19
CD_shp <- 22
HD_shp <- 21
CH_shp_box <- 22
HH_shp_box <- 21
my_shapes <- c(CH_shp, HH_shp, CD_shp, HD_shp)
my_shapes_box <- c(CH_shp_box, HH_shp_box, CD_shp, HD_shp)

my_labels <- c("Cool Humid\n0.6 kPa",
                               "Hot Humid\n1.1 kPa",
                               "Cool Dry\n2.5 kPa",
                               "Hot Dry\n3.8 kPa")
```



## SMI 

### Ind + Means

```{r SMI actual fig}
ggplot() + 
  geom_line(data = dat,
            aes(x = day_n,
                y = SMI, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme_classic() + 
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("Day") + 
  ylab("Body Condition (g)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0.1, #top
                             0.1, #right
                             0.1, #bottom
                             0.41 #left
                             ), "cm")) -> SMI_fig
SMI_fig
#ggsave(filename = "SMI_fig1.jpeg",
 #      plot = SMI_fig,
  #     path = "./results_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 6, height = 6)
```

### Means Only *MS*

```{r SMI actual-min fig}
ggplot() + 
  #plot these first so they end up on the "bottom"
  geom_smooth(data = dat_no_rehab,
                  aes(x = day_n,
                y = SMI, 
                color = tmt,
                group = tmt),
              method = "lm",
              se = F,
              size = 0.7) +
  geom_errorbar(data = means,
                  aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                group = tmt,
                ymin = mean_SMI-se_SMI, 
                ymax = mean_SMI+se_SMI),
                width = .1,
                #position=position_dodge(.01),
                alpha = 0.7) +
  #geom_line(data = means,
   #         aes(x = day_n,
    #            y = mean_SMI, 
     #           color = tmt,
      #          #linetype = tmt,
       #         group = tmt),
        #    alpha = 1, 
         #   size = 0.5) +
  geom_point(data = means,
            aes(x = day_n,
                y = mean_SMI, 
                color = tmt,
                #fill = tmt,
                shape = tmt),
            fill = "white",
            alpha = 1, 
            size = 3) +
  
  theme_classic() + 
  scale_shape_manual(values = my_shapes, name = "",
                     labels = my_labels) +
  scale_fill_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_color_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(seq(8,12)),
                     labels = c(seq(8,12))) +
  xlab("Day") + 
  ylab("Body Condition (g')") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = margin(t = 6, r = 6, b = 6, l = 10.8, unit = "pt")
) -> SMI_fig_min
SMI_fig_min
```



### LM + SE

```{r mass prez version}
ggplot() + 
  geom_smooth(data = dat_no_rehab,
              aes(x = day_n,
                  y = mass_g, 
                  color = tmt,
                  group = tmt),
              formula = y ~ x, 
              method = "lm", 
              se = T, 
              size = 1.2, 
              alpha = 0.2) + 
  theme_classic() + 
  #scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(limits = c(0,8),
                     breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("Acclimation Day") + 
  ylab("Lizard Mass (g)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none"
) -> SMI_lm_fig
SMI_lm_fig
```


### Ending Values *MS*

```{r SMI ending vals}
ggplot() +
  geom_jitter(data = end_vals,
              aes(x = tmt,
                   y = SMI, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = SMI_emmeans,
                aes(x = tmt,
                    y = emmean, 
                    color = tmt,
                    group = tmt,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = .1,
                alpha = 0.9) +
  geom_point(data = SMI_emmeans, 
             aes(x = tmt,
                   y = emmean, 
                   #color = tmt,
                 shape = tmt,
                 fill = tmt), 
             color = "black",
               size = 4) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes_box, name = "") +
  scale_fill_manual(values = my_colors, name = "") +
  scale_color_manual(values = my_colors, name = "") +
  scale_y_continuous(limits = c(7,15),
                     breaks = c(seq(7,15, by = 2)),
                     labels = c(seq(7,15, by = 2))) +
  scale_x_discrete(labels = c("Cool Humid\n0.6 kPa",
                               "Hot Humid\n1.1 kPa",
                               "Cool Dry\n2.5 kPa",
                               "Hot Dry\n3.8 kPa")) + 
  xlab("") + 
  
  annotate(geom = "text", x = 4, y = 12.7, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 12.2, label = "9.4", #HD
           size = 3) +
  annotate(geom = "text", x = 2, y = 14.2, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 2, y = 13.7, label = "9.6", #HH
           size = 3) +
  annotate(geom = "text", x = 3, y = 14.8, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 14.3, label = "10.7", #CD
           size = 3) +
  annotate(geom = "text", x = 1, y = 14.6, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 14.1, label = "10.8", #CH
           size = 3) +
  
  ylab("Body Condition (g')") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              3.4), "mm")
        ) -> SMI_end_boxplot
SMI_end_boxplot
SMI_emmeans
SMI_pairwise
```





## Hct 

### Ind + Means

```{r hct actual fig}
ggplot() +
  geom_line(data = dat[complete.cases(dat$hematocrit_percent),],
            aes(x = day_n,
                y = hematocrit_percent, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means[complete.cases(means$mean_hct),],
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = means,
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme_classic() + 
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("") + 
  ylab("Hematocrit (%)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0.1, #top
                             0.1, #right
                             0.1, #bottom
                             0.41 #left
                             ), "cm")
        ) -> hct_fig
hct_fig
```



### Means Only *MS*

```{r hct actual-minimal fig}
ggplot() +
  geom_smooth(data = dat_no_rehab[complete.cases(dat_no_rehab$hematocrit_percent),],
                  aes(x = day_n,
                y = hematocrit_percent, 
                color = tmt,
                group = tmt),
              method = "lm",
              se = F,
              size = 0.7) +
  geom_errorbar(data = means[complete.cases(means$mean_hct),],
                  aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                group = tmt,
                ymin = mean_hct-se_hct, 
                ymax = mean_hct+se_hct),
                width = .1,
                #position=position_dodge(.1),
                alpha = 0.7) +
  #geom_line(data = means[complete.cases(means$mean_hct),],
   #         aes(x = day_n,
    #            y = mean_hct, 
     #           color = tmt,
      #          #linetype = tmt,
       #         group = tmt),
        #    alpha = 1, 
         #   size = 0.5) +
  geom_point(data = means[complete.cases(means$mean_hct),],
            aes(x = day_n,
                y = mean_hct, 
                color = tmt,
                #fill = tmt,
                shape = tmt),
            alpha = 1, 
            fill = "white",
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes, name = "",
                     labels = my_labels) +
  scale_fill_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_color_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(25, 30, 35, 40),
                     labels = c(25, 30, 35, 40),) +
  xlab("") + 
  ylab("Hematocrit (%)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = margin(t = 6, r = 6, b = 0, l = 10.8, unit = "pt")
        ) -> hct_fig_min
hct_fig_min
```



### Ending Values *MS*


```{r hct ending vals}
ggplot() +
  geom_jitter(data = end_vals,
              aes(x = tmt,
                   y = hematocrit_percent, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = hct_emmeans,
                aes(x = tmt,
                    y = emmean, 
                    color = tmt,
                    group = tmt,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = .1,
                alpha = 0.9) +
  geom_point(data = hct_emmeans, 
             aes(x = tmt,
                   y = emmean, 
                   #color = tmt,
                 shape = tmt,
                 fill = tmt), 
             color = "black",
               size = 4) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes_box, name = "") +
  scale_fill_manual(values = my_colors, name = "") +
  scale_color_manual(values = my_colors, name = "") +
  xlab("") + 
  scale_y_continuous(limits = c(10,55),
                     breaks = c(seq(10,50, by = 10)),
                     labels = c(seq(10,50, by = 10))) +
  scale_x_discrete(labels = c("Cool Humid\n0.6 kPa",
                               "Hot Humid\n1.1 kPa",
                               "Cool Dry\n2.5 kPa",
                               "Hot Dry\n3.8 kPa")) + 
  
  annotate(geom = "text", x = 4, y = 47.6, label = "AB", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 45, label = "28", #HD
           size = 3) +
  annotate(geom = "text", x = 2, y = 44.6, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 2, y = 42, label = "26", #HH
           size = 3) +
  annotate(geom = "text", x = 3, y = 54.6, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 52, label = "30", #CD
           size = 3) +
  annotate(geom = "text", x = 1, y = 54.6, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 52, label = "30", #CH
           size = 3) +
  
  ylab("Hematocrit (%)") + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              2.24), "mm")
        ) -> hct_end_boxplot
hct_end_boxplot
hct_emmeans
hct_pairwise
```




## Osml 

### Ind + Means


```{r osmolality actual fig}
ggplot() + 
  geom_line(data = dat[complete.cases(dat$osmolality_mmol_kg_mean),],
            aes(x = day_n,
                y = osmolality_mmol_kg_mean, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means[complete.cases(means$mean_osml),],
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = means,
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  ylim(300,450) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("") + 
  ylab("Plasma Osmolality (mmol/kg)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme_classic() +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0.6, #top
                             0.1, #right
                             0.1, #bottom
                             0.1 #left
                             ), "cm")
        ) -> osml_fig
osml_fig
```


### Means Only *MS*


```{r osmolality actual-minimal fig}
ggplot() + 
  geom_smooth(data = dat_no_rehab[complete.cases(dat_no_rehab$osmolality_mmol_kg_mean),],
                  aes(x = day_n,
                y = osmolality_mmol_kg_mean, 
                color = tmt,
                group = tmt),
              method = "lm",
              se = F,
              size = 0.7) +
  geom_errorbar(data = means,
                  aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                group = tmt,
                ymin = mean_osml-se_osml, 
                ymax = mean_osml+se_osml),
                width = .1,
                #position=position_dodge(.1),
                alpha = 0.7) +
  #geom_line(data = means[complete.cases(means$mean_osml),],
   #         aes(x = day_n,
    #            y = mean_osml, 
     #           color = tmt,
      #          #linetype = tmt,
       #         group = tmt),
        #    alpha = 1, 
         #   size = 0.5) +
  geom_point(data = means,
            aes(x = day_n,
                y = mean_osml, 
                color = tmt,
                #fill = tmt,
                shape = tmt),
            fill = "white",
            alpha = 1, 
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes, name = "",
                     labels = my_labels) +
  scale_fill_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_color_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(seq(320,400, by = 10)),
                     labels = c(seq(320,400, by = 10))) +
  xlab("") + 
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  geom_vline(xintercept = 9,
             linetype = "dashed",
             color = "darkgrey") +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = margin(t = 6, r = 6, b = 0, l = 1, unit = "pt")
        ) -> osml_fig_min
osml_fig_min
```


### Stats! Check Pairwise Diffs ~ Time

Since Plasma osmolality has such a nonlinear trend, we need to test whether the elevated values in the middle of the experiment are significantly different than the values taken before and/or after.

```{r}
# first make sub-dfs for each tmt group
HH <- dat_no_rehab %>%
  dplyr::filter(substr(tmt, 1, 6) == "Hot Hu")
HD <- dat_no_rehab %>%
  dplyr::filter(substr(tmt, 1, 6) == "Hot Dr")
CH <- dat_no_rehab %>%
  dplyr::filter(substr(tmt, 1, 6) == "Cool H")
CD <- dat_no_rehab %>%
  dplyr::filter(substr(tmt, 1, 6) == "Cool D")

# next do pairwise tests for osml on the diff exp days, for each tmt group
pair_HH <- TukeyHSD(aov(data = HH, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
pair_HD <- TukeyHSD(aov(data = HD, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
pair_CH <- TukeyHSD(aov(data = CH, osmolality_mmol_kg_mean ~ day_factor)) #nonsig
pair_CD <- TukeyHSD(aov(data = CD, osmolality_mmol_kg_mean ~ day_factor)) #nonsig

# put into a df and export
osml_pairwise_df <- as.data.frame(pair_HD[[1]]) %>%
  rbind(as.data.frame(pair_HH[[1]])) %>%
  rbind(as.data.frame(pair_CD[[1]])) %>%
  rbind(as.data.frame(pair_CH[[1]])) %>%
  mutate(day_diff = paste("day", substr(rownames(.), 1, 3)),
         tmt = c(rep("Hot Dry",3),
                 rep("Hot Humid",3),
                 rep("Cool Dry",3),
                 rep("Cool Humid",3)),
         CI_95 = paste(round(lwr, digits = 2), round(upr, digits = 2), sep = ", "),
         diff = round(diff, digits = 2)) %>%
  dplyr::select(tmt, day_diff, diff, CI_95, p_adj = "p adj")
write.csv(osml_pairwise_df, "./results_statistics/osmolality_pairwise_diffs.csv")
```

nope, none of the differences between days within tmt groups are significantly different 


### LM + SE


```{r osmolality lm fig}
ggplot() + 
  stat_smooth(data = dat_no_rehab,
              aes(x = day_n,
                  y = osmolality_mmol_kg_mean, 
                  color = tmt,
                  fill = tmt,
                  group = tmt),
              formula = y ~ x, 
              method = "lm", 
              se = T, 
              size = 2, 
              alpha = 0.1) + 
  theme_classic() + 
  #scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(limits = c(0,8), 
                     breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  scale_fill_brewer(palette = "Set2", name = "") +
  xlab("Acclimation Day") + 
  #ylim(340,370) + #CANNOT put ylimits in bc gets rid of pts that are used to make lines
  ylab("Plasma Osmolality\n(mmol/kg)") + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 30),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 20),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none"
        ) -> osml_lm_fig
osml_lm_fig
```



### Ending Values *MS*

```{r osml ending vals}
ggplot() +
  geom_jitter(data = end_vals,
              aes(x = tmt,
                   y = osmolality_mmol_kg_mean, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = osml_emmeans,
                aes(x = tmt,
                    y = emmean, 
                    color = tmt,
                    group = tmt,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = .1,
                alpha = 0.9) +
  geom_point(data = osml_emmeans, 
             aes(x = tmt,
                   y = emmean, 
                   #color = tmt,
                 shape = tmt,
                 fill = tmt), 
             color = "black",
               size = 4) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes_box, name = "") +
  scale_fill_manual(values = my_colors, name = "") +
  scale_color_manual(values = my_colors, name = "") +
  scale_y_continuous(limits = c(290,470),
                     breaks = c(seq(300,450, by = 50)),
                     labels = c(seq(300,450, by = 50))) +
  scale_x_discrete(labels = c("Cool Humid\n0.6 kPa",
                               "Hot Humid\n1.1 kPa",
                               "Cool Dry\n2.5 kPa",
                               "Hot Dry\n3.8 kPa")) + 
  xlab("") + 
  
  annotate(geom = "text", x = 4, y = 427, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 417, label = "362", #HD
           size = 3) +
  annotate(geom = "text", x = 2, y = 452, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 2, y = 442, label = "354", #HH
           size = 3) +
  annotate(geom = "text", x = 3, y = 437, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 427, label = "349", #CD
           size = 3) +
  annotate(geom = "text", x = 1, y = 470, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 460, label = "350", #CH
           size = 3) +
  
  ylab(bquote('Osmolality (mmol '*kg^-1*')')) + 
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              0), "mm")
        ) -> osml_end_boxplot
osml_end_boxplot
osml_emmeans
osml_pairwise
```




## CEWL

### Ind + Means


```{r CEWL actual fig}
ggplot() + 
  geom_line(data = dat[complete.cases(dat$CEWL_g_m2h_mean),],
            aes(x = day_n,
                y = CEWL_g_m2h_mean, 
                color = tmt,
                group = individual_ID),
            alpha = 0.2) +
  geom_line(data = means[complete.cases(means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                group = tmt),
            alpha = 1, 
            size = 1) +
  geom_point(data = means[complete.cases(means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                shape = tmt),
            alpha = 1, 
            size = 5) +
  theme_classic() + 
  scale_shape_manual(values = c(15:18), name = "") +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  xlab("Day") + 
  ylim(0,60) +
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 16),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "bottom"
        #legend.position = c(0.25,0.85)
        ) -> CEWL_fig
CEWL_fig
#ggsave(filename = "CEWL_fig1.jpeg",
 #      plot = CEWL_fig,
  #     path = "./results_figures",
   #    device = "jpeg",
    #   dpi = 1200,
     #  width = 6, height = 6)
```



### Means Only *MS*

```{r CEWL actual fig minimal}
ggplot() + 
  geom_errorbar(data = means[complete.cases(means$mean_CEWL),],
                  aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                group = tmt,
                ymin = mean_CEWL-se_CEWL, 
                ymax = mean_CEWL+se_CEWL),
                width = .1,
                #position=position_dodge(.1),
                alpha = 0.7) +
  geom_line(data = means[complete.cases(means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                #linetype = tmt,
                group = tmt),
            alpha = 1, 
            size = .5) +
  geom_point(data = means[complete.cases(means$mean_CEWL),],
            aes(x = day_n,
                y = mean_CEWL, 
                color = tmt,
                shape = tmt),
            fill = "white",
            alpha = 1, 
            size = 3) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes, name = "",
                     labels = my_labels) +
  scale_fill_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_color_manual(values = my_colors, name = "",
                     labels = my_labels) +
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_y_continuous(breaks = c(20, 25, 30, 35, 40),
                     limits = c(18,40)) +
  xlab("Day") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none"
        #legend.position = c(0.25,0.85)
        ) -> CEWL_fig_min
CEWL_fig_min

# use ggarrange so legend is centered
CEWL_fig_formatted <- ggarrange(CEWL_fig_min,
                                ncol = 1, nrow = 1,
                                common.legend = TRUE,
                                legend = "bottom")
# save
ggsave(filename = "experiment_CEWL_fig.pdf",
       plot = CEWL_fig_formatted,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 90)

```




### LM + SE


```{r CEWL lm fig}
ggplot() + 
  stat_smooth(data = dat,
              aes(x = day_n,
                  y = CEWL_g_m2h_mean, 
                  color = tmt,
                  fill = tmt,
                  group = tmt),
              formula = y ~ x, 
              method = "lm", 
              se = T, 
              size = 2, 
              alpha = 0.2) + 
  theme_classic() + 
  scale_x_continuous(breaks = c(0, 2, 4, 6, 8)) +
  scale_color_brewer(palette = "Set2", name = "") +
  scale_fill_brewer(palette = "Set2", name = "") +
  xlab("Acclimation Day") + 
  ylab(bquote('CEWL (g/'*m^2*'h)')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 30),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 20),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 22),
        legend.text.align = 0,
        legend.position = "none"
        #legend.position = c(0.25,0.85)
        ) -> CEWL_lm_fig
CEWL_lm_fig
```






### delta CEWL ~ VPD

```{r}
ggplot(data = dat_no_rehab_deltaCEWL) +
  geom_point(aes(x = VPD_kPa_tmttrial,
                   y = delta_CEWL, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 2,
              alpha = 0.4
             ) +
  geom_smooth(aes(x = VPD_kPa_tmttrial,
                   y = delta_CEWL), 
              se = F,
              formula = y ~ x,
              method = "lm",
              color = "black") +
  #geom_smooth(aes(x = VPD_kPa_tmttrial,
   #                y = delta_CEWL), 
    #          se = F,
     #         formula = y ~ poly(x, 2),
      #        method = "lm",
       #       color = "red") +
  theme_classic() + 
  scale_shape_manual(values = my_shapes_box, name = "",
                     labels = c("Cool Humid (CH)",
                               "Hot Humid (HH)",
                               "Cool Dry (CD)",
                               "Hot Dry (HD)")) +
  scale_fill_manual(values = my_colors, name = "",
                     labels = c("Cool Humid (CH)",
                               "Hot Humid (HH)",
                               "Cool Dry (CD)",
                               "Hot Dry (HD)")) +
  scale_color_manual(values = my_colors, name = "",
                     labels = c("Cool Humid (CH)",
                               "Hot Humid (HH)",
                               "Cool Dry (CD)",
                               "Hot Dry (HD)")) +
  scale_y_continuous(limits = c(-13,40),
                     breaks = c(seq(-10,40, by = 10)),
                     labels = c(seq(-10,40, by = 10))
                     ) +
  scale_x_continuous(limits = c(0,4),
                     breaks = c(0.6, 1.1, 2.5, 3.8),
                     labels = c("0.6\nCH", 
                                "1.1\nHH", 
                                "2.5\nCD", 
                                "3.8\nHD")) +
  xlab("Vapor Pressure Deficit (kPa)") + 
  ylab(expression(Delta ~ 'CEWL')) + 
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "bottom",
        legend.spacing.y = unit(0, "mm")
        #plot.margin = unit(c(0, #top
         #                     0, #right
          #                    0, #bottom
           #                   0), "mm")
        ) -> CEWL_VPD_fig
CEWL_VPD_fig

# use ggarrange so legend is centered
CEWL_VPD_fig_formatted <- ggarrange(CEWL_VPD_fig,
                                ncol = 1, nrow = 1,
                                common.legend = TRUE,
                                legend = "bottom")
# save
ggsave(filename = "exp_CEWL_delta_VPD.pdf",
       plot = CEWL_VPD_fig_formatted,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 90)
```





### Ending Values *MS*

```{r}
ggplot() +
  geom_jitter(data = end_vals,
              aes(x = tmt,
                   y = CEWL_g_m2h_mean, 
                   color = tmt,
                 fill = tmt,
                 shape = tmt), 
               size = 1,
              alpha = 0.4,
              position = position_jitter(height = 0, width = 0.2)) +
  geom_errorbar(data = CEWL_emmeans,
                aes(x = tmt,
                    y = emmean, 
                    color = tmt,
                    group = tmt,
                    ymin = lower.CL, 
                    ymax = upper.CL),
                width = .1,
                alpha = 0.9) +
  geom_point(data = CEWL_emmeans, 
             aes(x = tmt,
                   y = emmean, 
                   #color = tmt,
                 shape = tmt,
                 fill = tmt), 
             color = "black",
               size = 4) +
  theme_classic() + 
  scale_shape_manual(values = my_shapes_box, name = "") +
  scale_fill_manual(values = my_colors, name = "") +
  scale_color_manual(values = my_colors, name = "") +
  scale_x_discrete(labels = c("Cool Humid\n0.6 kPa",
                               "Hot Humid\n1.1 kPa",
                               "Cool Dry\n2.5 kPa",
                               "Hot Dry\n3.8 kPa")) + 
  scale_y_continuous(limits = c(9,63),
                     breaks = c(seq(10,60, by = 10)),
                     labels = c(seq(10,60, by = 10))) +
  xlab("") + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) + 
  
  annotate(geom = "text", x = 4, y = 50, label = "C", 
           size = 3) +
  annotate(geom = "text", x = 4, y = 47, label = "25", #HD
           size = 3) +
  annotate(geom = "text", x = 2, y = 63, label = "B", 
           size = 3) +
  annotate(geom = "text", x = 2, y = 60, label = "37", #HH
           size = 3) +
  annotate(geom = "text", x = 3, y = 41, label = "C", 
           size = 3) +
  annotate(geom = "text", x = 3, y = 38, label = "24", #CD
           size = 3) +
  annotate(geom = "text", x = 1, y = 52, label = "A", 
           size = 3) +
  annotate(geom = "text", x = 1, y = 49, label = "30", #CH
           size = 3) +
  
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        #axis.text.x = element_blank(),
        legend.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.text.align = 0,
        legend.position = "none",
        plot.margin = unit(c(0, #top
                              0, #right
                              0, #bottom
                              0), "mm")
        ) -> CEWL_end_boxplot
CEWL_end_boxplot
CEWL_emmeans
CEWL_pairwise
```




## Exp CEWL ~ Osml

```{r CEWL osml fig}
end_vals_CEWL_osml <- dat %>%
  dplyr::filter(day_n == 8) %>%
  dplyr::filter(complete.cases(CEWL_g_m2h_mean, osmolality_mmol_kg_mean))

ggplot(end_vals_CEWL_osml) + 
  aes(x = osmolality_mmol_kg_mean,
      y = CEWL_g_m2h_mean,
      color = tmt,
      shape = tmt) +
  geom_point(size = 1.5, 
             alpha = 0.8) + 
  stat_smooth(formula = y ~ x, 
              method = "lm", 
              se = F, 
              size = 1, 
              alpha = 0.9) + 
  theme_classic() + 
  xlab(bquote('Osmolality (mmol '*kg^-1*')')) + 
  ylab(bquote('CEWL (g '*m^-2*' '*h^-1*')')) + 
  #xlim(300, 400) +
  #ylim(0, 40) +
  scale_shape_manual(values = c(21,19, 22,15), name = "") +
  scale_fill_brewer(palette = "Spectral", name = "") +
  scale_color_brewer(palette = "Spectral", name = "") +
  scale_x_continuous(breaks = c(300, 350, 400, 450)) +
  scale_y_continuous(breaks = c(20, 30, 40, 50),
                     limits = c(12,57)) +
  guides(shape = guide_legend(nrow = 2, byrow = TRUE)) +
  theme(text = element_text(color = "black", 
                            family = "sans", 
                            size = 12),
        axis.text = element_text(color = "black", 
                                 family = "sans", 
                                 size = 8),
        legend.position = "bottom"
        #axis.text.y = element_blank(),
        #plot.margin = unit(c(0.1,0,0.1,0.45), "cm")
        ) -> exp_end_CEWL_osml_fig
exp_end_CEWL_osml_fig

# will need to save using figure arrange to make legend centered if I use that fig
ggsave(filename = "exp_CEWL_osml_fig.pdf",
       plot = exp_end_CEWL_osml_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 90)
```



## Multi-Figures

over time:

```{r arrange figs}
ggarrange(osml_fig_min, 
          hct_fig_min, 
          SMI_fig_min,
          ncol = 1, nrow = 3,
          labels = c("A", "B", "C"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> experiment_multi_fig
#experiment_multi_fig
# export figure
ggsave(filename = "experiment_multi_fig.pdf",
       plot = experiment_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 80, height = 210)
```


end values:

```{r}
ggarrange(CEWL_end_boxplot, 
          osml_end_boxplot, 
          hct_end_boxplot,
          SMI_end_boxplot, 
          ncol = 2, nrow = 2,
          labels = c("A", "B", "C", "D"),
          widths = c(2, 2.045), heights = c(2, 2),
          common.legend = FALSE
          ) -> ending_values_multi_fig
#ending_values_multi_fig

ggsave(filename = "exp_end_val_multi_fig.pdf",
       plot = ending_values_multi_fig,
       path = "./results_figures",
       device = "pdf",
       dpi = 600,
       units = "mm",
       width = 180, height = 150)
```













